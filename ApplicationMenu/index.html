<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:html="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="text/html; charset=utf-8"></meta><link rel="stylesheet" type="text/css" media="all" href="https://static.gnome.org/css/grass-theme-style.css"></link><link rel="stylesheet" type="text/css" media="all" href="../skin/lgo2010.css"></link><link rel="icon" type="image/png" href="../skin/gnome-16.png"></link><link rel="SHORTCUT ICON" type="image/png" href="../skin/gnome-16.png"></link><link rel="search" type="application/opensearchdescription+xml" href="../gnome-library-search.xml" title="GNOME Library Search"></link><link rel="stylesheet" href="../skin/moinmoin.css" type="text/css"></link><title>HowDoI/ApplicationMenu - GNOME Wiki!</title><link href="https://wiki.gnome.org/action/rss_rc/HowDoI/ApplicationMenu?diffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=HowDoI%2FApplicationMenu&amp;ddiffs=1" rel="alternate" title="GNOME Wiki!: HowDoI/ApplicationMenu" type="application/rss+xml"></link><link href="https://wiki.gnome.org/Home" rel="Start"></link><link href="https://wiki.gnome.org/action/raw/HowDoI/ApplicationMenu?action=raw" rel="Alternate" title="Wiki Markup"></link><link href="https://wiki.gnome.org/action/print/HowDoI/ApplicationMenu?action=print" media="print" rel="Alternate" title="Print View"></link><link href="https://wiki.gnome.org/HowDoI" rel="Up"></link><link href="https://wiki.gnome.org/HowDoI/ApplicationMenu?action=AttachFile&amp;do=view&amp;target=appmenu.png" rel="Appendix" title="appmenu.png"></link><link href="https://wiki.gnome.org/HowDoI/ApplicationMenu?action=AttachFile&amp;do=view&amp;target=fallack2.png" rel="Appendix" title="fallack2.png"></link><link href="https://wiki.gnome.org/HowDoI/ApplicationMenu?action=AttachFile&amp;do=view&amp;target=fallback1.png" rel="Appendix" title="fallback1.png"></link><link href="https://wiki.gnome.org/HowDoI/ApplicationMenu?action=AttachFile&amp;do=view&amp;target=fallback3.png" rel="Appendix" title="fallback3.png"></link><link href="https://wiki.gnome.org/FindPage" rel="Search"></link><link href="https://wiki.gnome.org/TitleIndex" rel="Index"></link><link href="https://wiki.gnome.org/WordIndex" rel="Glossary"></link><link href="https://wiki.gnome.org/HelpOnFormatting" rel="Help"></link><link rel="stylesheet" type="text/css" media="all" href="../skin/jquery.autocomplete.css"></link><link rel="stylesheet" type="text/css" media="all" href="../skin/960_24_col.css"></link><script type="text/javascript" src="../js/jquery.js"></script><script type="text/javascript" src="https://developer-old.gnome.org/js/jquery.jcarousel.min.js"></script><script type="text/javascript" src="../js/jquery.autocomplete.js"></script></head><body><div id="accessibility_access"><ul><li><a href="index.html#container">Go to page content</a></li><li><a href="index.html#top_bar">Go to main menu</a></li><li><a href="index.html#s" onclick="$('#s').focus(); return false;">Go to the search field</a></li></ul></div><div id="global_domain_bar"><div class="maxwidth"><div class="tab"><a class="root" href="https://www.gnome.org/">GNOME.org</a></div></div></div><div id="header" class="container_12"><div id="logo" class="grid_3"><a title="Go to home page" href="../index.html"><img alt="GNOME: The Free Software Desktop Project" src="../skin/gnome-logo-devcenter.png"></img></a></div><div id="top_bar" class="grid_9"><div class="left"><div class="menu-globalnav-container"><ul id="menu-globalnav" class="menu"><li class="menu-item menu-item-type-post_type menu-item-6"><a href="../about/index.html">About</a></li><li class="menu-item menu-item-type-post_type menu-item-23"><a href="https://help.gnome.org/users/">Users</a></li><li class="menu-item menu-item-type-post_type menu-item-40"><a href="https://help.gnome.org/admin/">Administrators</a></li><li class="current-menu-item"><a href="https://developer.gnome.org/">Developers</a></li></ul></div></div><div class="right"><form role="search" method="get" id="searchform" action="https://developer-old.gnome.org/search"><div><label class="hidden" for="q">Search:
                        </label><input type="text" value="" name="q" id="s" placeholder="Search"></input></div></form></div></div></div><div class="clearfix"></div><div id="container" class="content-id"><div class="content"><div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867">
</p><h1 id="Making_an_application_menu">Making an application menu</h1>
<span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867"><img align="right" alt="appmenu.png" class="attachment" src="https://wiki.gnome.org/HowDoI/ApplicationMenu?action=AttachFile&amp;do=get&amp;target=appmenu.png" title="appmenu.png"></img> <span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span></p><p class="line874">This page describes how to get a menu for your application into the top bar of gnome-shell. <span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span></p><p class="line867"><img alt="/!\" height="16" src="https://wiki.gnome.org/gnome/gnome-responsive/img/dialog-warning-symbolic.png" title="/!\" width="16"></img> <strong>DEPRECATION WARNING</strong>: Application menus are in <a class="https" href="https://gitlab.gnome.org/GNOME/Initiatives/wikis/App-Menu-Retirement">the process of being phased out</a>. Instead of using an application menu, you're strongly encouraged to follow these steps: <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span></p><ol type="1"><li>Remove the app menu and move any menu items to the primary menu <span class="anchor" id="line-10"></span></li><li>Where necessary, split the primary menu into primary and secondary menus <span class="anchor" id="line-11"></span></li><li>Rename the about menu item from "About" to "About application-name" <span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span></li></ol><p class="line874">Application menus won't be shown in the top bar of GNOME Shell any more starting from GNOME 3.34; they will be placed in the header bar or the title bar of the application window, instead. <span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span></p><p class="line862">GTK4 does not provide API to set application menus. <img alt="/!\" height="16" src="https://wiki.gnome.org/gnome/gnome-responsive/img/dialog-warning-symbolic.png" title="/!\" width="16"></img> <span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span></p><p class="line867">
</p><h2 id="Requirements">Requirements</h2>
<span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span><p class="line862">In order to have an application menu, you must be using GtkApplication.  See <a href="https://wiki.gnome.org/HowDoI/GtkApplication">HowDoI/GtkApplication</a>. <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span></p><p class="line862">Each item you want exposed in your application menu must already be exposed as a GAction.  See <a href="https://wiki.gnome.org/HowDoI/GAction">HowDoI/GAction</a>. <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span></p><p class="line867">
</p><h2 id="Overview">Overview</h2>
<span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><p class="line862">Application menus are defined using GMenu and published by setting the GMenu on your GtkApplication using <tt class="backtick">gtk_application_set_app_menu()</tt> from your application's startup function. <span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span></p><p class="line874">The easiest way to define a GMenu is using XML. <span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span></p><p class="line867">
</p><h2 id="Actions_vs._presentation">Actions vs. presentation</h2>
<span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><p class="line862">As mentioned in <a href="https://wiki.gnome.org/HowDoI/GAction">HowDoI/GAction</a>, actions contain no presentation information. <span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span></p><p class="line874">As a dual to this, GMenu is almost entirely presentational information. <span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span></p><ul><li>layout of the items into a hierarchy of submenus and sections <span class="anchor" id="line-36"></span></li><li>labels for each item <span class="anchor" id="line-37"></span></li><li>(optional) icons for items <span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span></li></ul><p class="line874">Each clickable item in a GMenu also contains a reference (by name) to the action it is associated with. <span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span></p><p class="line862">Action presentation information should not ever be changed.  For this reason, items in a GMenu are immutable.  The idea here is that all of this information should be contained within a <a class="nonexistent" href="https://wiki.gnome.org/GtkBuilder">GtkBuilder</a> file and never modified.  GMenus themselves are mutable, however, to allow for the possibility of inserting and removing programmatically-created items such as you would want to do with a bookmark menu.  The items themselves are still immutable, however. <span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span></p><p class="line874">All dynamic changes to a menu item are made by changing the state of the action that they associate with.  The easiest example is that of showing a check mark or radio indicator on a menu item: you do this by setting the correct state on the associated action -- not by modifying the menu item. <span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span></p><p class="line874">This reflects the fact that the application menu (which is only defined once) may refer to actions on multiple windows, where those actions have different state, per window. <span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span></p><p class="line867">
</p><h2 id="Action_scopes">Action scopes</h2>
<span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><p class="line862">When referred to from a <tt class="backtick">GMenu</tt> or <tt class="backtick">GtkActionable</tt> widget, action names are always given in a form like "app.quit" or "win.fullscreen".  The part before the dot is the scope of the action and, presently, will always be "app" or "win". <span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span></p><p class="line862">"app" actions affect the application as a whole and are installed directly on the <a class="nonexistent" href="https://wiki.gnome.org/GtkApplication">GtkApplication</a>.  "win" actions affect one window specifically and are installed onto each <a class="nonexistent" href="https://wiki.gnome.org/GtkApplicationWindow">GtkApplicationWindow</a>. <span class="anchor" id="line-52"></span><span class="anchor" id="line-53"></span></p><p class="line874">When the application menu is shown by the shell, the "win." actions are referring to the copy of this action on the currently focused window.  If such an action does not exist, the menu item will be greyed out. <span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span></p><p class="line874">The "app.quit" form is used only from the presentation layer (ie: from GMenu or widgets).  When defining the actions themselves, only the name is used ("quit").  You create an action named "quit" and install it onto the application, and then refer to that from the GMenu as "app.quit".  Similarly, you create an action named "fullscreen" and install it onto a window, and then refer to that from the menu as "win.fullscreen". <span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span></p><p class="line867"><span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span></p><pre><span class="anchor" id="line-1"></span>static void
<span class="anchor" id="line-2"></span>quit_cb (GSimpleAction *action,
<span class="anchor" id="line-3"></span>         GVariant      *parameter,
<span class="anchor" id="line-4"></span>         gpointer       user_data)
<span class="anchor" id="line-5"></span>{
<span class="anchor" id="line-6"></span>  /* ...quit... */
<span class="anchor" id="line-7"></span>}
<span class="anchor" id="line-8"></span>
<span class="anchor" id="line-9"></span>const GActionEntry app_actions[] = {
<span class="anchor" id="line-10"></span>  { "quit", quit_cb }
<span class="anchor" id="line-11"></span>};
<span class="anchor" id="line-12"></span>
<span class="anchor" id="line-13"></span>static void
<span class="anchor" id="line-14"></span>my_app_startup (GApplication *app)
<span class="anchor" id="line-15"></span>{
<span class="anchor" id="line-16"></span>  /* ... */
<span class="anchor" id="line-17"></span>
<span class="anchor" id="line-18"></span>  GMenu *menu;
<span class="anchor" id="line-19"></span>
<span class="anchor" id="line-20"></span>  // for the actions, we use the name "quit"
<span class="anchor" id="line-21"></span>  g_action_map_add_action_entries (G_ACTION_MAP (app), app_actions, G_N_ELEMENTS (app_actions), app);
<span class="anchor" id="line-22"></span>
<span class="anchor" id="line-23"></span>  // from the menu, we refer to the action as "app.quit" since we installed it on the application
<span class="anchor" id="line-24"></span>  menu = g_menu_new ();
<span class="anchor" id="line-25"></span>  g_menu_append (menu, "Quit", "app.quit");
<span class="anchor" id="line-26"></span>
<span class="anchor" id="line-27"></span>  /* ... */
<span class="anchor" id="line-28"></span>  gtk_application_set_app_menu (GTK_APPLICATION (app),
<span class="anchor" id="line-29"></span>                                G_MENU_MODEL (menu));
<span class="anchor" id="line-30"></span>  g_object_unref (menu);
<span class="anchor" id="line-31"></span>}</pre><span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span><p class="line867">
</p><h2 id="Submenus">Submenus</h2>
<span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span><p class="line867">
</p><h2 id="Sections.2C_separators.2C_headings">Sections, separators, headings</h2>
<span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><p class="line874">GMenu does not use explicitly inserted separators.  Instead, it has a concept of sections.  Like a submenu, each subsection of a GMenu is, itself, a GMenu. <span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span></p><p class="line874">In C: <span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span></p><p class="line867"><span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><span class="anchor" id="line-1-1"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
function isnumbered(obj) {
  return obj.childNodes.length && obj.firstChild.childNodes.length && obj.firstChild.firstChild.className == 'LineNumber';
}
function nformat(num,chrs,add) {
  var nlen = Math.max(0,chrs-(''+num).length), res = '';
  while (nlen>0) { res += ' '; nlen-- }
  return res+num+add;
}
function addnumber(did, nstart, nstep) {
  var c = document.getElementById(did), l = c.firstChild, n = 1;
  if (!isnumbered(c)) {
    if (typeof nstart == 'undefined') nstart = 1;
    if (typeof nstep  == 'undefined') nstep = 1;
    var n = nstart;
    while (l != null) {
      if (l.tagName == 'SPAN') {
        var s = document.createElement('SPAN');
        var a = document.createElement('A');
        s.className = 'LineNumber';
        a.appendChild(document.createTextNode(nformat(n,4,'')));
        a.href = '#' + did + '_' + n;
        s.appendChild(a);
        s.appendChild(document.createTextNode(' '));
        n += nstep;
        if (l.childNodes.length) {
          l.insertBefore(s, l.firstChild);
        }
        else {
          l.appendChild(s);
        }
      }
      l = l.nextSibling;
    }
  }
  return false;
}
function remnumber(did) {
  var c = document.getElementById(did), l = c.firstChild;
  if (isnumbered(c)) {
    while (l != null) {
      if (l.tagName == 'SPAN' && l.firstChild.className == 'LineNumber') l.removeChild(l.firstChild);
      l = l.nextSibling;
    }
  }
  return false;
}
function togglenumber(did, nstart, nstep) {
  var c = document.getElementById(did);
  if (isnumbered(c)) {
    remnumber(did);
  } else {
    addnumber(did,nstart,nstep);
  }
  return false;
}
</script>

<script type="text/javascript">
document.write('<a href="index.html#" onclick="return togglenumber(\'CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script>
<pre dir="ltr" id="CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec" lang="en"><span class="line"><span class="LineNumber"><a href="index.html#CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_1">   1</a> </span><span class="LineAnchor" id="CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_1"></span><span class="anchor" id="line-1-2"></span>{</span>
<span class="line"><span class="LineNumber"><a href="index.html#CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_2">   2</a> </span><span class="LineAnchor" id="CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_2"></span><span class="anchor" id="line-2-1"></span>  <span class="ID">GMenu</span> *<span class="ID">edit_menu</span>;</span>
<span class="line"><span class="LineNumber"><a href="index.html#CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_3">   3</a> </span><span class="LineAnchor" id="CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_3"></span><span class="anchor" id="line-3-1"></span>  <span class="ID">GMenu</span> *<span class="ID">s1</span>, *<span class="ID">s2</span>;</span>
<span class="line"><span class="LineNumber"><a href="index.html#CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_4">   4</a> </span><span class="LineAnchor" id="CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_4"></span><span class="anchor" id="line-4-1"></span></span>
<span class="line"><span class="LineNumber"><a href="index.html#CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_5">   5</a> </span><span class="LineAnchor" id="CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_5"></span><span class="anchor" id="line-5-1"></span>  <span class="ID">edit_menu</span> = <span class="ID">g_menu_new</span> ();</span>
<span class="line"><span class="LineNumber"><a href="index.html#CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_6">   6</a> </span><span class="LineAnchor" id="CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_6"></span><span class="anchor" id="line-6-1"></span></span>
<span class="line"><span class="LineNumber"><a href="index.html#CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_7">   7</a> </span><span class="LineAnchor" id="CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_7"></span><span class="anchor" id="line-7-1"></span>  <span class="ID">s1</span> = <span class="ID">g_menu_new</span> ();</span>
<span class="line"><span class="LineNumber"><a href="index.html#CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_8">   8</a> </span><span class="LineAnchor" id="CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_8"></span><span class="anchor" id="line-8-1"></span>  <span class="ID">g_menu_append</span> (<span class="ID">s1</span>, <span class="ID">_</span>(<span class="String">"</span><span class="String">Copy</span><span class="String">"</span>), <span class="String">"</span><span class="String">win.copy</span><span class="String">"</span>);</span>
<span class="line"><span class="LineNumber"><a href="index.html#CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_9">   9</a> </span><span class="LineAnchor" id="CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_9"></span><span class="anchor" id="line-9-1"></span>  <span class="ID">g_menu_append</span> (<span class="ID">s1</span>, <span class="ID">_</span>(<span class="String">"</span><span class="String">Paste</span><span class="String">"</span>), <span class="String">"</span><span class="String">win.paste</span><span class="String">"</span>);</span>
<span class="line"><span class="LineNumber"><a href="index.html#CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_10">  10</a> </span><span class="LineAnchor" id="CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_10"></span><span class="anchor" id="line-10-1"></span>  <span class="ID">g_menu_append_section</span> (<span class="ID">edit_menu</span>, <span class="ResWord">NULL</span>, <span class="ID">s1</span>);</span>
<span class="line"><span class="LineNumber"><a href="index.html#CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_11">  11</a> </span><span class="LineAnchor" id="CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_11"></span><span class="anchor" id="line-11-1"></span></span>
<span class="line"><span class="LineNumber"><a href="index.html#CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_12">  12</a> </span><span class="LineAnchor" id="CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_12"></span><span class="anchor" id="line-12-1"></span>  <span class="ID">s2</span> = <span class="ID">g_menu_new</span> ();</span>
<span class="line"><span class="LineNumber"><a href="index.html#CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_13">  13</a> </span><span class="LineAnchor" id="CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_13"></span><span class="anchor" id="line-13-1"></span>  <span class="ID">g_menu_append</span> (<span class="ID">s2</span>, <span class="ID">_</span>(<span class="String">"</span><span class="String">Preferences</span><span class="String">"</span>), <span class="String">"</span><span class="String">app.preferences</span><span class="String">"</span>);</span>
<span class="line"><span class="LineNumber"><a href="index.html#CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_14">  14</a> </span><span class="LineAnchor" id="CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_14"></span><span class="anchor" id="line-14-1"></span>  <span class="ID">g_menu_append_section</span> (<span class="ID">edit_menu</span>, <span class="ResWord">NULL</span>, <span class="ID">s2</span>);</span>
<span class="line"><span class="LineNumber"><a href="index.html#CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_15">  15</a> </span><span class="LineAnchor" id="CA-feeeed9743724f2c5b4d54807c11dac9f61a75ec_15"></span><span class="anchor" id="line-15-1"></span>}</span>
</pre></div></div><span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><p class="line874">or the same, in XML: <span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span></p><p class="line867"><span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span></p><pre><span class="anchor" id="line-1-1"></span>  &lt;menu&gt;
<span class="anchor" id="line-2-1"></span>    &lt;section&gt;
<span class="anchor" id="line-3-1"></span>      &lt;item&gt;
<span class="anchor" id="line-4-1"></span>        &lt;attribute name="label" translatable="yes"&gt;Copy&lt;/attribute&gt;
<span class="anchor" id="line-5-1"></span>        &lt;attribute name="action"&gt;win.copy&lt;/attribute&gt;
<span class="anchor" id="line-6-1"></span>      &lt;/item&gt;
<span class="anchor" id="line-7-1"></span>      &lt;item&gt;
<span class="anchor" id="line-8-1"></span>        &lt;attribute name="label" translatable="yes"&gt;Paste&lt;/attribute&gt;
<span class="anchor" id="line-9-1"></span>        &lt;attribute name="action"&gt;win.paste&lt;/attribute&gt;
<span class="anchor" id="line-10-1"></span>      &lt;/item&gt;
<span class="anchor" id="line-11-1"></span>    &lt;/section&gt;
<span class="anchor" id="line-12-1"></span>    &lt;section&gt;
<span class="anchor" id="line-13-1"></span>      &lt;item&gt;
<span class="anchor" id="line-14-1"></span>        &lt;attribute name="label" translatable="yes"&gt;Preferences&lt;/attribute&gt;
<span class="anchor" id="line-15-1"></span>        &lt;attribute name="action"&gt;app.preferences&lt;/attribute&gt;
<span class="anchor" id="line-16-1"></span>      &lt;/item&gt;
<span class="anchor" id="line-17-1"></span>    &lt;/section&gt;
<span class="anchor" id="line-18-1"></span>  &lt;/menu&gt;</pre><span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><p class="line862">Note that double-quotes (") are used in the XML as <a class="https" href="https://bugs.launchpad.net/intltool/+bug/1034153">intltool does not recognise single-quotes (')</a>. <span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span></p><p class="line874">Separators are automatically inserted between sections. <span class="anchor" id="line-143"></span><span class="anchor" id="line-144"></span></p><p class="line874">Strictly speaking, a separator is inserted at the top of any non-empty section that is not the first section. <span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span></p><p class="line862">Sections can also be named (see "View as" in the image above).  This is the second parameter to <tt class="backtick">g_menu_append_section()</tt> which is NULL in the example above.  If a section is named then a section heading will appear at the top of the section, in place of the separator.  In this case, the section heading is shown if the section is non-empty, even if the section is the first section. <span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span></p><p class="line874">Sections can be nested, but separators are only inserted between the toplevel sections within a menu. <span class="anchor" id="line-149"></span><span class="anchor" id="line-150"></span></p><p class="line867">
</p><h2 id="Attributes_on_menu_items">Attributes on menu items</h2>
<span class="anchor" id="line-151"></span><span class="anchor" id="line-152"></span><p class="line867">
</p><h2 id="Toggles.2C_radios">Toggles, radios</h2>
<span class="anchor" id="line-153"></span><span class="anchor" id="line-154"></span><p class="line874">Toggle menu items and radio items are made in exactly the same way as a normal menu item.  The only different is the type of the action that they are associated with. <span class="anchor" id="line-155"></span><span class="anchor" id="line-156"></span></p><p class="line862">See <a href="https://wiki.gnome.org/HowDoI/GAction">HowDoI/GAction</a> for information on how to create an action that will be rendered as a toggle or radio item. <span class="anchor" id="line-157"></span><span class="anchor" id="line-158"></span></p><p class="line862">Note that, in contrast to other systems, in GMenuModel, a <strong>radio group</strong> of menu items all share the same action, but use a different target value on that action. <span class="anchor" id="line-159"></span><span class="anchor" id="line-160"></span></p><p class="line874">See the following XML sniplet. <span class="anchor" id="line-161"></span><span class="anchor" id="line-162"></span></p><p class="line867"><span class="anchor" id="line-163"></span><span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span><span class="anchor" id="line-167"></span><span class="anchor" id="line-168"></span><span class="anchor" id="line-169"></span><span class="anchor" id="line-170"></span><span class="anchor" id="line-171"></span><span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span><span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span><span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><span class="anchor" id="line-178"></span><span class="anchor" id="line-179"></span><span class="anchor" id="line-180"></span><span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span><span class="anchor" id="line-183"></span><span class="anchor" id="line-184"></span><span class="anchor" id="line-185"></span><span class="anchor" id="line-186"></span><span class="anchor" id="line-187"></span><span class="anchor" id="line-188"></span></p><pre><span class="anchor" id="line-1-2"></span>&lt;menu id="appmenu"&gt;
<span class="anchor" id="line-2-2"></span>  &lt;section&gt;
<span class="anchor" id="line-3-2"></span>    &lt;item&gt;
<span class="anchor" id="line-4-2"></span>      &lt;attribute name="label" translatable="yes"&gt;Fullscreen&lt;/attribute&gt;
<span class="anchor" id="line-5-2"></span>      &lt;attribute name="action"&gt;win.fullscreen&lt;/attribute&gt;
<span class="anchor" id="line-6-2"></span>    &lt;/item&gt;
<span class="anchor" id="line-7-2"></span>  &lt;/section&gt;
<span class="anchor" id="line-8-2"></span>  &lt;section&gt;
<span class="anchor" id="line-9-2"></span>    &lt;item&gt;
<span class="anchor" id="line-10-2"></span>      &lt;attribute name="label" translatable="yes"&gt;Left Align&lt;/attribute&gt;
<span class="anchor" id="line-11-2"></span>      &lt;attribute name="action"&gt;win.justify&lt;/attribute&gt;
<span class="anchor" id="line-12-2"></span>      &lt;attribute name="target"&gt;left&lt;/attribute&gt;
<span class="anchor" id="line-13-2"></span>    &lt;/item&gt;
<span class="anchor" id="line-14-2"></span>    &lt;item&gt;
<span class="anchor" id="line-15-2"></span>      &lt;attribute name="label" translatable="yes"&gt;Center&lt;/attribute&gt;
<span class="anchor" id="line-16-2"></span>      &lt;attribute name="action"&gt;win.justify&lt;/attribute&gt;
<span class="anchor" id="line-17-2"></span>      &lt;attribute name="target"&gt;center&lt;/attribute&gt;
<span class="anchor" id="line-18-2"></span>    &lt;/item&gt;
<span class="anchor" id="line-19-1"></span>    &lt;item&gt;
<span class="anchor" id="line-20-1"></span>      &lt;attribute name="label" translatable="yes"&gt;Right Align&lt;/attribute&gt;
<span class="anchor" id="line-21-1"></span>      &lt;attribute name="action"&gt;win.justify&lt;/attribute&gt;
<span class="anchor" id="line-22-1"></span>      &lt;attribute name="target"&gt;right&lt;/attribute&gt;
<span class="anchor" id="line-23-1"></span>    &lt;/item&gt;
<span class="anchor" id="line-24-1"></span>  &lt;/section&gt;
<span class="anchor" id="line-25-1"></span>&lt;/menu&gt;</pre><span class="anchor" id="line-189"></span><span class="anchor" id="line-190"></span><p class="line874">...and the equivalent in C: <span class="anchor" id="line-191"></span><span class="anchor" id="line-192"></span></p><p class="line867"><span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span><span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span><span class="anchor" id="line-197"></span><span class="anchor" id="line-198"></span><span class="anchor" id="line-199"></span><span class="anchor" id="line-200"></span><span class="anchor" id="line-201"></span><span class="anchor" id="line-202"></span><span class="anchor" id="line-203"></span><span class="anchor" id="line-204"></span><span class="anchor" id="line-205"></span><span class="anchor" id="line-206"></span><span class="anchor" id="line-207"></span><span class="anchor" id="line-208"></span><span class="anchor" id="line-209"></span><span class="anchor" id="line-210"></span><span class="anchor" id="line-211"></span><span class="anchor" id="line-212"></span></p><pre><span class="anchor" id="line-1-3"></span>{
<span class="anchor" id="line-2-3"></span>  GMenu *section, *appmenu;
<span class="anchor" id="line-3-3"></span>
<span class="anchor" id="line-4-3"></span>  appmenu = g_menu_new ();
<span class="anchor" id="line-5-3"></span>
<span class="anchor" id="line-6-3"></span>  section = g_menu_new ();
<span class="anchor" id="line-7-3"></span>  g_menu_append (section, "Fullscreen", "win.fullscreen);
<span class="anchor" id="line-8-3"></span>  g_menu_append_section (appmenu, NULL, section);
<span class="anchor" id="line-9-3"></span>  g_object_unref (section);
<span class="anchor" id="line-10-3"></span>
<span class="anchor" id="line-11-3"></span>  section = g_menu_new ();
<span class="anchor" id="line-12-3"></span>  g_menu_append (section, "Left Align", "justify::left");
<span class="anchor" id="line-13-3"></span>  g_menu_append (section, "Center", "justify::center");
<span class="anchor" id="line-14-3"></span>  g_menu_append (section, "Right Align", "justify::right");
<span class="anchor" id="line-15-3"></span>  g_menu_append_section (appmenu, NULL, section);
<span class="anchor" id="line-16-3"></span>  g_object_unref (section);
<span class="anchor" id="line-17-3"></span>
<span class="anchor" id="line-18-3"></span>  ...
<span class="anchor" id="line-19-2"></span>}</pre><span class="anchor" id="line-213"></span><span class="anchor" id="line-214"></span><p class="line867">
</p><h2 id="Icons">Icons</h2>
<span class="anchor" id="line-215"></span><span class="anchor" id="line-216"></span><p class="line862">GMenu has support for icons, but this support works differently than it did in <tt class="backtick">GtkMenu</tt>. <span class="anchor" id="line-217"></span><span class="anchor" id="line-218"></span></p><p class="line862">The most important thing to understand is the semantic difference between icons in GtkMenu and those in GMenu.  In GtkMenu, icons were used for verbs -- things like "save", "print", etc. <span class="anchor" id="line-219"></span><span class="anchor" id="line-220"></span></p><p class="line874">In GMenu, icons are never used for verbs.  They are only used for nouns: things like a webpage, an application, a device.  In these cases, the icon would be the favicon for the page, the icon for the application or a representative icon for the device. <span class="anchor" id="line-221"></span><span class="anchor" id="line-222"></span></p><p class="line862">The way the icon is positioned is also different: icons from GtkImageMenuItem were positioned at the same place as the checkmark in GtkCheckMenuItem (and it was not possible to have a menu with both an icon and a checkmark).  In menus rendered by GMenu, the icon is positioned to the left of the label, and causes the label to be pushed to the right.  Because the icon is drawn in the space that normally belongs to the label, it is still possible to have a check or radio indicator in the usual place. <span class="anchor" id="line-223"></span><span class="anchor" id="line-224"></span></p><p class="line862">Any <tt class="backtick">GIcon</tt> can be used as the icon for a menu item, using g_menu_item_set_icon(). <span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span></p><p class="line867"><span class="anchor" id="line-227"></span><span class="anchor" id="line-228"></span><span class="anchor" id="line-229"></span><span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span><span class="anchor" id="line-232"></span><span class="anchor" id="line-233"></span><span class="anchor" id="line-234"></span><span class="anchor" id="line-235"></span><span class="anchor" id="line-236"></span><span class="anchor" id="line-237"></span><span class="anchor" id="line-238"></span><span class="anchor" id="line-239"></span><span class="anchor" id="line-240"></span><span class="anchor" id="line-241"></span><span class="anchor" id="line-242"></span><span class="anchor" id="line-243"></span><span class="anchor" id="line-244"></span><span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span></p><pre><span class="anchor" id="line-1-4"></span>{
<span class="anchor" id="line-2-4"></span>  GdkPixbuf *pixbuf;
<span class="anchor" id="line-3-4"></span>  const gchar *url;
<span class="anchor" id="line-4-4"></span>  GMenuItem *item;
<span class="anchor" id="line-5-4"></span>
<span class="anchor" id="line-6-4"></span>  pixbuf = bookmark_get_favicon (bookmark);
<span class="anchor" id="line-7-4"></span>  url = bookmark_get_url (bookmark);
<span class="anchor" id="line-8-4"></span>
<span class="anchor" id="line-9-4"></span>  item = g_menu_item_new (bookmark_get_name (bookmark), NULL);
<span class="anchor" id="line-10-4"></span>  g_menu_item_set_action_and_target (item, "app.open-url", "s", url);
<span class="anchor" id="line-11-4"></span>
<span class="anchor" id="line-12-4"></span>  if (pixbuf != NULL)
<span class="anchor" id="line-13-4"></span>    {
<span class="anchor" id="line-14-4"></span>      g_menu_item_set_icon (item, G_ICON (pixbuf));
<span class="anchor" id="line-15-4"></span>      g_object_unref (pixbuf);
<span class="anchor" id="line-16-4"></span>    }
<span class="anchor" id="line-17-4"></span>
<span class="anchor" id="line-18-4"></span>  g_menu_append_item (bookmarks_menu, item);
<span class="anchor" id="line-19-3"></span>}</pre><span class="anchor" id="line-247"></span><span class="anchor" id="line-248"></span><p class="line867">
</p><h2 id="Fallback">Fallback</h2>
<span class="anchor" id="line-249"></span><span class="anchor" id="line-250"></span><p class="line874">What if your application gets run in a desktop environment that doesn't support application menus ? GTK+ will take care of making your menu available, with a fallback. If the ::show-menubar property on your application window is set to TRUE (the default), it will insert a menubar to present your menu: <span class="anchor" id="line-251"></span><span class="anchor" id="line-252"></span></p><p class="line867"><img align="center" alt="fallback1.png" class="attachment" src="https://wiki.gnome.org/HowDoI/ApplicationMenu?action=AttachFile&amp;do=get&amp;target=fallback1.png" title="fallback1.png"></img> <span class="anchor" id="line-253"></span><span class="anchor" id="line-254"></span></p><p class="line874">If you want to provide your own fallback, disable the built-in fallback by calling <span class="anchor" id="line-255"></span><span class="anchor" id="line-256"></span></p><p class="line867"><span class="anchor" id="line-257"></span><span class="anchor" id="line-258"></span></p><pre><span class="anchor" id="line-1-5"></span>  gtk_application_window_set_show_menubar (win, FALSE);</pre><span class="anchor" id="line-259"></span><span class="anchor" id="line-260"></span><p class="line874">With client-side window decorations, GTK+ provides fallback in the form of a menu button: <span class="anchor" id="line-261"></span><span class="anchor" id="line-262"></span></p><p class="line867"><img align="center" alt="fallack2.png" class="attachment" src="https://wiki.gnome.org/HowDoI/ApplicationMenu?action=AttachFile&amp;do=get&amp;target=fallack2.png" title="fallack2.png"></img> <span class="anchor" id="line-263"></span><span class="anchor" id="line-264"></span></p><p class="line862">The <tt class="backtick">GtkHeaderBar</tt> widget will automatically determine whether to show the fallback menu button if the environment <a class="https" href="https://developer.gnome.org/gtk3/stable/GtkSettings.html#GtkSettings--gtk-shell-shows-app-menu">does not support application menus</a>, and if the <a class="https" href="https://developer.gnome.org/gtk3/stable/GtkSettings.html#GtkSettings--gtk-decoration-layout">GtkSettings:gtk-decoration-layout</a> property contains the <tt class="backtick">menu</tt> string. <span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span><span class="anchor" id="line-267"></span></p><p class="line867"><img align="center" alt="fallback3.png" class="attachment" src="https://wiki.gnome.org/HowDoI/ApplicationMenu?action=AttachFile&amp;do=get&amp;target=fallback3.png" title="fallback3.png"></img> <span class="anchor" id="line-268"></span><span class="anchor" id="line-269"></span></p><p class="line874">If you want to force fallback application menu button, you should change the value of those settings using something like: <span class="anchor" id="line-270"></span><span class="anchor" id="line-271"></span></p><p class="line867"><span class="anchor" id="line-272"></span><span class="anchor" id="line-273"></span><span class="anchor" id="line-274"></span><span class="anchor" id="line-275"></span><span class="anchor" id="line-276"></span></p><pre><span class="anchor" id="line-1-6"></span>  g_object_set (gtk_widget_get_settings (headerbar),
<span class="anchor" id="line-2-5"></span>                "gtk-shell-shows-app-menu", FALSE,
<span class="anchor" id="line-3-5"></span>                "gtk-decoration-layout", "menu:close",
<span class="anchor" id="line-4-5"></span>                NULL);</pre><span class="anchor" id="line-277"></span><span class="anchor" id="bottom"></span></div></div><div id="footer_art" class="default"> </div></div><div class="clearfix"></div><div id="footer_grass">   </div><div id="footer"><div class="container_12"><div class="links grid_9"><div class="menu-footer-1-container"><ul id="menu-footer-1" class="menu"><li id="menu-item-88" class="menu-item menu-item-type-custom menu-item-home menu-item-88"><a href="https://www.gnome.org/">The GNOME Project</a><ul class="sub-menu"><li id="menu-item-89" class="menu-item menu-item-type-post_type menu-item-89"><a href="https://www.gnome.org/about/">About Us</a></li><li id="menu-item-90" class="menu-item menu-item-type-custom menu-item-90"><a href="https://www.gnome.org/get-involved/">Get Involved</a></li><li id="menu-item-91" class="menu-item menu-item-type-custom menu-item-91"><a href="https://www.gnome.org/teams/">Teams</a></li><li id="menu-item-92" class="menu-item menu-item-type-custom menu-item-92"><a href="https://foundation.gnome.org">The GNOME Foundation</a></li><li><a href="https://www.gnome.org/support-gnome/">Support GNOME</a></li><li><a href="https://www.gnome.org/contact/">Contact</a></li></ul></li></ul></div><div class="menu-footer-2-container"><ul id="menu-footer-2" class="menu"><li id="menu-item-99" class="menu-item menu-item-type-post_type current-menu-item page_item page-item-20 current_page_item menu-item-99"><a href="index.html#">Resources</a><ul class="sub-menu"><li><a href="https://help.gnome.org">Documentation</a></li><li><a href="https://wiki.gnome.org">Wiki</a></li><li><a href="https://mail.gnome.org/mailman/listinfo">Mailing Lists</a></li><li><a href="https://wiki.gnome.org/GnomeIrcChannels">IRC Channels</a></li><li><a href="https://gitlab.gnome.org/">Bug Tracker</a></li><li><a href="https://gitlab.gnome.org/">Development Code</a></li><li><a href="https://wiki.gnome.org/Jhbuild">Build Tool</a></li></ul></li></ul></div><div class="menu-footer-4-container"><ul id="menu-footer-4" class="menu"><li id="menu-item-104" class="menu-item menu-item-type-custom menu-item-104"><a href="http://www.gnome.org/news/">News</a><ul class="sub-menu"><li><a href="https://www.gnome.org/start/stable">Latest Release</a></li><li><a href="https://planet.gnome.org">Planet GNOME</a></li><li><a href="https://news.gnome.org">Development News</a></li><li><a href="https://twitter.com/gnome">Twitter</a></li></ul></li></ul></div></div><div class="links grid_3 right"><div><ul class="menu available_languages"><li><strong>This website is available in many languages</strong><ul class="sub-menu"><li><a href="../languages.html" title="Switching Language">Switch Language</a></li></ul></li></ul><script type="text/javascript" src="../js/language.js"></script></div></div><div id="footnotes" class="grid_9">
                Copyright © 2005‒2014 <strong class="gnome_logo">The GNOME Project</strong><br></br><small>Optimised for standards. Hosted by <a href="http://redhat.com">Red Hat</a>.</small></div><div class="clear"></div></div></div><script type="text/javascript">
$(document).ready(function() {
    // Get browser
    $.each($.browser, function(i) {
        $('body').addClass(i);
        return false;
    });

    // Get OS and add it as class to body tag, this then allows forcing some
    // customisation in the CSS rules.
    var match = navigator.userAgent.toLowerCase().match(/(win|mac|linux)/);
    if (match) {
        $('body').addClass(match[0]);
    }
});
</script><script type="text/javascript">
      var _paq = _paq || [];
      _paq.push(['disableCookies']);
      _paq.push(["trackPageView"]);
      _paq.push(["enableLinkTracking"]);

      (function() {
        var u=(("https:" == document.location.protocol) ? "https" : "http") + "://webstats.gnome.org/";
        _paq.push(["setTrackerUrl", u+"piwik.php"]);
        _paq.push(["setSiteId", "6"]);
        var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";
        g.defer=true; g.async=true; g.src=u+"piwik.js"; s.parentNode.insertBefore(g,s);
      })();
    </script></body></html>
