<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:html="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="text/html; charset=utf-8"></meta><link rel="stylesheet" type="text/css" media="all" href="https://static.gnome.org/css/grass-theme-style.css"></link><link rel="stylesheet" type="text/css" media="all" href="../skin/lgo2010.css"></link><link rel="icon" type="image/png" href="../skin/gnome-16.png"></link><link rel="SHORTCUT ICON" type="image/png" href="../skin/gnome-16.png"></link><link rel="search" type="application/opensearchdescription+xml" href="../gnome-library-search.xml" title="GNOME Library Search"></link><link rel="stylesheet" href="../skin/moinmoin.css" type="text/css"></link><title>HowDoI/SearchProvider - GNOME Wiki!</title><link href="https://wiki.gnome.org/action/rss_rc/HowDoI/SearchProvider?diffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=HowDoI%2FSearchProvider&amp;ddiffs=1" rel="alternate" title="GNOME Wiki!: HowDoI/SearchProvider" type="application/rss+xml"></link><link href="https://wiki.gnome.org/Home" rel="Start"></link><link href="https://wiki.gnome.org/action/raw/HowDoI/SearchProvider?action=raw" rel="Alternate" title="Wiki Markup"></link><link href="https://wiki.gnome.org/action/print/HowDoI/SearchProvider?action=print" media="print" rel="Alternate" title="Print View"></link><link href="https://wiki.gnome.org/HowDoI" rel="Up"></link><link href="https://wiki.gnome.org/HowDoI/SearchProvider?action=AttachFile&amp;do=view&amp;target=gnome-shell-search-results.png" rel="Appendix" title="gnome-shell-search-results.png"></link><link href="https://wiki.gnome.org/HowDoI/SearchProvider?action=AttachFile&amp;do=view&amp;target=search-provider-configuration.png" rel="Appendix" title="search-provider-configuration.png"></link><link href="https://wiki.gnome.org/FindPage" rel="Search"></link><link href="https://wiki.gnome.org/TitleIndex" rel="Index"></link><link href="https://wiki.gnome.org/WordIndex" rel="Glossary"></link><link href="https://wiki.gnome.org/HelpOnFormatting" rel="Help"></link><link rel="stylesheet" type="text/css" media="all" href="../skin/jquery.autocomplete.css"></link><link rel="stylesheet" type="text/css" media="all" href="../skin/960_24_col.css"></link><script type="text/javascript" src="../js/jquery.js"></script><script type="text/javascript" src="https://developer-old.gnome.org/js/jquery.jcarousel.min.js"></script><script type="text/javascript" src="../js/jquery.autocomplete.js"></script></head><body><div id="accessibility_access"><ul><li><a href="index.html#container">Go to page content</a></li><li><a href="index.html#top_bar">Go to main menu</a></li><li><a href="index.html#s" onclick="$('#s').focus(); return false;">Go to the search field</a></li></ul></div><div id="global_domain_bar"><div class="maxwidth"><div class="tab"><a class="root" href="https://www.gnome.org/">GNOME.org</a></div></div></div><div id="header" class="container_12"><div id="logo" class="grid_3"><a title="Go to home page" href="../index.html"><img alt="GNOME: The Free Software Desktop Project" src="../skin/gnome-logo-devcenter.png"></img></a></div><div id="top_bar" class="grid_9"><div class="left"><div class="menu-globalnav-container"><ul id="menu-globalnav" class="menu"><li class="menu-item menu-item-type-post_type menu-item-6"><a href="../about/index.html">About</a></li><li class="menu-item menu-item-type-post_type menu-item-23"><a href="https://help.gnome.org/users/">Users</a></li><li class="menu-item menu-item-type-post_type menu-item-40"><a href="https://help.gnome.org/admin/">Administrators</a></li><li class="current-menu-item"><a href="https://developer.gnome.org/">Developers</a></li></ul></div></div><div class="right"><form role="search" method="get" id="searchform" action="https://developer-old.gnome.org/search"><div><label class="hidden" for="q">Search:
                        </label><input type="text" value="" name="q" id="s" placeholder="Search"></input></div></form></div></div></div><div class="clearfix"></div><div id="container" class="content-id"><div class="content"><div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867">
</p><h1 id="Search_Provider">Search Provider</h1>
<span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line874">Search is a central concept in the GNOME user experience. The search entry in the shell overview is the place to go for <span class="anchor" id="line-4"></span>quick searches. <span class="anchor" id="line-5"></span><span class="anchor" id="line-6"></span></p><p class="line862">A search provider is a mechanism by which an application can expose its search capabilities to <a href="https://wiki.gnome.org/Projects/GnomeShell">GNOME Shell</a>. When the user types anything in the shell's search entry, the text is forwarded to all known search providers, and the results are relayed back for display. <span class="anchor" id="line-7"></span><span class="anchor" id="line-8"></span></p><p class="line862">In the shell overview, search hits are grouped against their respective applications and a maximum of three is shown per application. The user can either select an individual result, in which case the application SHOULD <em>open</em> it; or she can select the application icon, in which case it COULD show an in-app view of all the results from this specific application without any limitation. <span class="anchor" id="line-9"></span><span class="anchor" id="line-10"></span></p><p class="line862">The exact meaning of <em>open</em> depends on the application in question. <a href="https://wiki.gnome.org/Apps/Nautilus">Files</a> and <a href="https://wiki.gnome.org/Apps/Documents">Documents</a> offer a preview of the item's content; <a href="https://wiki.gnome.org/Apps/Software">Software</a> shows an UI to install the application; and <a href="https://wiki.gnome.org/Apps/Terminal">Terminal</a> windows are simply brought into focus. If possible, the applications SHOULD offer a way to go 'back' to its search view, which should be pre-populated with the same search that was done in the shell. This lets the user continue to refine his search inside the application. <span class="anchor" id="line-11"></span><span class="anchor" id="line-12"></span></p><p class="line874">Applications should be prepared to handle repeated queries as the user types more characters into the shell search entry. <span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span></p><p class="line867"><img alt="gnome-shell-search-results.png" class="attachment" src="https://wiki.gnome.org/HowDoI/SearchProvider?action=AttachFile&amp;do=get&amp;target=gnome-shell-search-results.png" title="gnome-shell-search-results.png"></img> <span class="anchor" id="line-15"></span><span class="anchor" id="line-16"></span></p><p class="line867">
</p><h2 id="Basics">Basics</h2>
<span class="anchor" id="line-17"></span><span class="anchor" id="line-18"></span><p class="line874">For an application to become a search provider, it should implement the following D-Bus interface: <span class="anchor" id="line-19"></span><span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-1-1"></span></p><div class="highlight xml"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-337a9eb417bf2614cf20d7b3256f71bf638b3dd8" lang="en"><span class="line"><span class="anchor" id="line-1-2"></span><span class="ID">&lt;node</span><span class="ID">&gt;</span></span>
<span class="line"><span class="anchor" id="line-2-1"></span>  <span class="ID">&lt;interface</span> <span class="ID">name=</span><span class="String">"org.gnome.Shell.SearchProvider2"</span><span class="ID">&gt;</span></span>
<span class="line"><span class="anchor" id="line-3-1"></span></span>
<span class="line"><span class="anchor" id="line-4-1"></span>    <span class="ID">&lt;method</span> <span class="ID">name=</span><span class="String">"GetInitialResultSet"</span><span class="ID">&gt;</span></span>
<span class="line"><span class="anchor" id="line-5-1"></span>      <span class="ID">&lt;arg</span> <span class="ID">type=</span><span class="String">"as"</span> <span class="ID">name=</span><span class="String">"terms"</span> <span class="ID">direction=</span><span class="String">"in"</span> <span class="ID">/&gt;</span></span>
<span class="line"><span class="anchor" id="line-6-1"></span>      <span class="ID">&lt;arg</span> <span class="ID">type=</span><span class="String">"as"</span> <span class="ID">name=</span><span class="String">"results"</span> <span class="ID">direction=</span><span class="String">"out"</span> <span class="ID">/&gt;</span></span>
<span class="line"><span class="anchor" id="line-7-1"></span>    <span class="ID">&lt;/method&gt;</span></span>
<span class="line"><span class="anchor" id="line-8-1"></span></span>
<span class="line"><span class="anchor" id="line-9-1"></span>    <span class="ID">&lt;method</span> <span class="ID">name=</span><span class="String">"GetSubsearchResultSet"</span><span class="ID">&gt;</span></span>
<span class="line"><span class="anchor" id="line-10-1"></span>      <span class="ID">&lt;arg</span> <span class="ID">type=</span><span class="String">"as"</span> <span class="ID">name=</span><span class="String">"previous_results"</span> <span class="ID">direction=</span><span class="String">"in"</span> <span class="ID">/&gt;</span></span>
<span class="line"><span class="anchor" id="line-11-1"></span>      <span class="ID">&lt;arg</span> <span class="ID">type=</span><span class="String">"as"</span> <span class="ID">name=</span><span class="String">"terms"</span> <span class="ID">direction=</span><span class="String">"in"</span> <span class="ID">/&gt;</span></span>
<span class="line"><span class="anchor" id="line-12-1"></span>      <span class="ID">&lt;arg</span> <span class="ID">type=</span><span class="String">"as"</span> <span class="ID">name=</span><span class="String">"results"</span> <span class="ID">direction=</span><span class="String">"out"</span> <span class="ID">/&gt;</span></span>
<span class="line"><span class="anchor" id="line-13-1"></span>    <span class="ID">&lt;/method&gt;</span></span>
<span class="line"><span class="anchor" id="line-14-1"></span></span>
<span class="line"><span class="anchor" id="line-15-1"></span>    <span class="ID">&lt;method</span> <span class="ID">name=</span><span class="String">"GetResultMetas"</span><span class="ID">&gt;</span></span>
<span class="line"><span class="anchor" id="line-16-1"></span>      <span class="ID">&lt;arg</span> <span class="ID">type=</span><span class="String">"as"</span> <span class="ID">name=</span><span class="String">"identifiers"</span> <span class="ID">direction=</span><span class="String">"in"</span> <span class="ID">/&gt;</span></span>
<span class="line"><span class="anchor" id="line-17-1"></span>      <span class="ID">&lt;arg</span> <span class="ID">type=</span><span class="String">"aa{sv}"</span> <span class="ID">name=</span><span class="String">"metas"</span> <span class="ID">direction=</span><span class="String">"out"</span> <span class="ID">/&gt;</span></span>
<span class="line"><span class="anchor" id="line-18-1"></span>    <span class="ID">&lt;/method&gt;</span></span>
<span class="line"><span class="anchor" id="line-19-1"></span></span>
<span class="line"><span class="anchor" id="line-20-1"></span>    <span class="ID">&lt;method</span> <span class="ID">name=</span><span class="String">"ActivateResult"</span><span class="ID">&gt;</span></span>
<span class="line"><span class="anchor" id="line-21-1"></span>      <span class="ID">&lt;arg</span> <span class="ID">type=</span><span class="String">"s"</span> <span class="ID">name=</span><span class="String">"identifier"</span> <span class="ID">direction=</span><span class="String">"in"</span> <span class="ID">/&gt;</span></span>
<span class="line"><span class="anchor" id="line-22-1"></span>      <span class="ID">&lt;arg</span> <span class="ID">type=</span><span class="String">"as"</span> <span class="ID">name=</span><span class="String">"terms"</span> <span class="ID">direction=</span><span class="String">"in"</span> <span class="ID">/&gt;</span></span>
<span class="line"><span class="anchor" id="line-23-1"></span>      <span class="ID">&lt;arg</span> <span class="ID">type=</span><span class="String">"u"</span> <span class="ID">name=</span><span class="String">"timestamp"</span> <span class="ID">direction=</span><span class="String">"in"</span> <span class="ID">/&gt;</span></span>
<span class="line"><span class="anchor" id="line-24-1"></span>    <span class="ID">&lt;/method&gt;</span></span>
<span class="line"><span class="anchor" id="line-25-1"></span></span>
<span class="line"><span class="anchor" id="line-26-1"></span>    <span class="ID">&lt;method</span> <span class="ID">name=</span><span class="String">"LaunchSearch"</span><span class="ID">&gt;</span></span>
<span class="line"><span class="anchor" id="line-27-1"></span>      <span class="ID">&lt;arg</span> <span class="ID">type=</span><span class="String">"as"</span> <span class="ID">name=</span><span class="String">"terms"</span> <span class="ID">direction=</span><span class="String">"in"</span> <span class="ID">/&gt;</span></span>
<span class="line"><span class="anchor" id="line-28-1"></span>      <span class="ID">&lt;arg</span> <span class="ID">type=</span><span class="String">"u"</span> <span class="ID">name=</span><span class="String">"timestamp"</span> <span class="ID">direction=</span><span class="String">"in"</span> <span class="ID">/&gt;</span></span>
<span class="line"><span class="anchor" id="line-29-1"></span>    <span class="ID">&lt;/method&gt;</span></span>
<span class="line"><span class="anchor" id="line-30-1"></span></span>
<span class="line"><span class="anchor" id="line-31-1"></span>  <span class="ID">&lt;/interface&gt;</span></span>
<span class="line"><span class="anchor" id="line-32-1"></span><span class="ID">&lt;/node&gt;</span></span>
</pre></div></div><span class="anchor" id="line-53"></span><p class="line862">You can also find a copy of this D-Bus interface definition at $(datadir)/dbus-1/interfaces/org.gnome.ShellSearchProvider2.xml <span class="anchor" id="line-54"></span><span class="anchor" id="line-55"></span></p><p class="line874">Register the search provider with GNOME Shell by dropping a file in $(datadir)/gnome-shell/search-providers. <span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span></p><p class="line862">Let's assume that we have an application called <em>Foo Bar</em> that is <a href="https://wiki.gnome.org/HowDoI/DBusApplicationLaunching">D-Bus activatable</a>, where <em>Foo</em> is the project-wide namespace and <em>Bar</em> is the name of the application. Then we can create a file called foo.bar.search-provider.ini as: <span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span></p><pre><span class="anchor" id="line-1"></span>[Shell Search Provider]
<span class="anchor" id="line-2"></span>DesktopId=foo.Bar.desktop
<span class="anchor" id="line-3"></span>BusName=foo.Bar
<span class="anchor" id="line-4"></span>ObjectPath=/foo/Bar/SearchProvider
<span class="anchor" id="line-5"></span>Version=2</pre><span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><p class="line874">Restart the shell to have it detect your search provider. Search queries from the user will now be forwarded to your application. <span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span></p><p class="line867">
</p><h2 id="Configuration">Configuration</h2>
<span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><p class="line862">The GNOME control-center has a settings panel that allows the user to configure which search providers to use in the shell, and in what order to show their results. This is handled completely between the control-center and the shell, your application is not involved other than providing the name its desktop file in the DesktopId key. Both the shell and the control-center use this key to find the icon and name to use in the UI to represent your search provider. <span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span></p><p class="line867"><img alt="search-provider-configuration.png" class="attachment" src="https://wiki.gnome.org/HowDoI/SearchProvider?action=AttachFile&amp;do=get&amp;target=search-provider-configuration.png" title="search-provider-configuration.png"></img> <span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span></p><p class="line867">
</p><h2 id="Details">Details</h2>
<span class="anchor" id="line-75"></span><span class="anchor" id="line-76"></span><p class="line874">Keep in mind is that activating the search provider by entering text in the shell search entry should not visibly launch the application. It is still possible to implement the search provider in the same binary as the application itself (which has the advantage that you can share the search implementation between the search provider and the in-application search); just make sure that activating the application starts it in 'service' mode. The startup() vfunc should not open any windows, that should only be done in activate() or open(). <span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span></p><p class="line862">Another point to keep in mind is that searching in the shell should not affect the UI of your application if it is already running <em>until</em> the user explicitly chooses to open (one or all) search results with the application. Once the user does that, it is expected that you reuse the already open window and switch it to the search view. <span class="anchor" id="line-79"></span><span class="anchor" id="line-80"></span></p><p class="line862">All methods of the SearchProvider interface should be implemented asynchronously, in particular, you should handle overlapping subsearch requests, as the user keeps typing in the shell search entry. A common way to deal with this is to <span class="anchor" id="line-81"></span>cancel the previous search request when a new one comes in.  <span class="anchor" id="line-82"></span><span class="anchor" id="line-83"></span></p><p class="line867">
</p><h2 id="The_SearchProvider_interface">The SearchProvider interface</h2>
<span class="anchor" id="line-84"></span><span class="anchor" id="line-85"></span><p class="line867"><span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span></p><pre><span class="anchor" id="line-1-1"></span>GetInitialResultSet :: (as) → (as)</pre><span class="anchor" id="line-88"></span><span class="anchor" id="line-89"></span><p class="line867">GetInitialResultSet is called when a new search is started. It gets an array of search terms as arguments, and should return an array of result IDs. gnome-shell will call GetResultMetas for (some) of these result IDs to get details about the result that can be be displayed in the result list. <span class="anchor" id="line-90"></span><span class="anchor" id="line-91"></span></p><p class="line867"><span class="anchor" id="line-92"></span><span class="anchor" id="line-93"></span></p><pre><span class="anchor" id="line-1-2"></span>GetSubsearchResultSet :: (as,as) → (as)</pre><span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span><p class="line867">GetSubsearchResultSet is called to refine the initial search results when the user types more characters in the search entry. It gets the previous search results and the current search terms as arguments, and should return an array of result IDs, just like GetInitialResulSet. <span class="anchor" id="line-96"></span><span class="anchor" id="line-97"></span></p><p class="line867"><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span></p><pre><span class="anchor" id="line-1-3"></span>GetResultMetas :: (as) → (aa{sv})</pre><span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span><p class="line867">GetResultMetas is called to obtain detailed information for results. It gets an array of result IDs as arguments, and should return a matching array of dictionaries (ie one a{sv} for each passed-in result ID). The following pieces of information should be provided for each result: <span class="anchor" id="line-102"></span></p><ul><li>"id": the result ID <span class="anchor" id="line-103"></span></li><li>"name": the display name for the result <span class="anchor" id="line-104"></span></li><li>"icon": a serialized GIcon (see g_icon_serialize()), or alternatively, <span class="anchor" id="line-105"></span></li><li>"gicon": a textual representation of a GIcon (see g_icon_to_string()), or alternativly, <span class="anchor" id="line-106"></span></li><li>"icon-data": a tuple of type (iiibiiay) describing a pixbuf with width, height, rowstride, has-alpha, bits-per-sample, and image data  <span class="anchor" id="line-107"></span></li><li>"description": an optional short description (1-2 lines) <span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span></li></ul><p class="line867"><span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span></p><pre><span class="anchor" id="line-1-4"></span>ActivateResult :: (s,as,u) → ()</pre><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><p class="line867">ActivateResult is called when the user clicks on an individual result to open it in the application. The arguments are the result ID, the current search terms and a timestamp. <span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span></p><p class="line867"><span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span></p><pre><span class="anchor" id="line-1-5"></span>LaunchSearch :: (as,u) → ()</pre><span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><p class="line867">LaunchSearch is called when the user clicks on the provider icon to display more search results in the application. The arguments are the current search terms and a timestamp. <span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span></p><p class="line867">
</p><h2 id="Implementation">Implementation</h2>
<span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><p class="line862">You can add a search provider to an application that is <a href="https://wiki.gnome.org/HowDoI/GtkApplication">using GtkApplication</a> by exporting the <a class="https" href="https://developer.gnome.org/gio/stable/GDBusInterfaceSkeleton.html">GDBusInterfaceSkeleton</a> that implementing the search provider interface in the dbus_register() vfunc. Often the search provider is in the same binary as the application itself because it has the advantage of being able to share the search implementation, but this is not mandatory. <span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span></p><p class="line862">Let's assume that we have an application called <em>Foo Bar</em>, where <em>Foo</em> is the project-wide namespace and <em>Bar</em> is the name of the application. Following are some typical examples of how it would look like in different languages. <span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span></p><p class="line867">
</p><h3 id="C_example">C example</h3>
<span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><p class="line862">The dbus_register() and dbus_unregister() vfuncs are overridden in BarApplication: <span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span></p><p class="line867"><span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><span class="anchor" id="line-150"></span><span class="anchor" id="line-1-3"></span></p><div class="highlight c"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-fdb26beb6f805244639dd9ed27b36457e786cd2f" lang="en"><span class="line"><span class="anchor" id="line-1-4"></span><span class="ID">G_DEFINE_TYPE</span> (<span class="ID">BarApplication</span>, <span class="ID">bar_application</span>, <span class="ID">GTK_TYPE_APPLICATION</span>);</span>
<span class="line"><span class="anchor" id="line-2-2"></span></span>
<span class="line"><span class="anchor" id="line-3-2"></span><span class="ResWord">static</span> <span class="ResWord">void</span></span>
<span class="line"><span class="anchor" id="line-4-2"></span><span class="ID">bar_application_class_init</span> (<span class="ID">BarApplicationClass</span> *<span class="ID">class</span>)</span>
<span class="line"><span class="anchor" id="line-5-2"></span>{</span>
<span class="line"><span class="anchor" id="line-6-2"></span>  <span class="ID">GApplicationClass</span> *<span class="ID">application_class</span> = <span class="ID">G_APPLICATION_CLASS</span> (<span class="ID">class</span>);</span>
<span class="line"><span class="anchor" id="line-7-2"></span></span>
<span class="line"><span class="anchor" id="line-8-2"></span>  <span class="ID">application_class</span>-&gt;<span class="ID">dbus_register</span> = <span class="ID">bar_application_dbus_register</span>;</span>
<span class="line"><span class="anchor" id="line-9-2"></span>  <span class="ID">application_class</span>-&gt;<span class="ID">dbus_unregister</span> = <span class="ID">bar_application_dbus_unregister</span>;</span>
<span class="line"><span class="anchor" id="line-10-2"></span>}</span>
<span class="line"><span class="anchor" id="line-11-2"></span></span>
<span class="line"><span class="anchor" id="line-12-2"></span><span class="ID">GtkApplication</span> *</span>
<span class="line"><span class="anchor" id="line-13-2"></span><span class="ID">bar_application_new</span> (<span class="ResWord">void</span>)</span>
<span class="line"><span class="anchor" id="line-14-2"></span>{</span>
<span class="line"><span class="anchor" id="line-15-2"></span>  <span class="ResWord">return</span> <span class="ID">g_object_new</span> (<span class="ID">BAR_TYPE_APPLICATION</span>,</span>
<span class="line"><span class="anchor" id="line-16-2"></span>                       <span class="String">"</span><span class="String">application-id</span><span class="String">"</span>, <span class="String">"</span><span class="String">foo.bar</span><span class="String">"</span>,</span>
<span class="line"><span class="anchor" id="line-17-2"></span>                       <span class="ResWord">NULL</span>);</span>
<span class="line"><span class="anchor" id="line-18-2"></span>}</span>
</pre></div></div><span class="anchor" id="line-151"></span><span class="anchor" id="line-152"></span><p class="line874">The application has claimed foo.bar on the bus and the object is exported at /foo/Bar/SearchProvider: <span class="anchor" id="line-153"></span><span class="anchor" id="line-154"></span></p><p class="line867"><span class="anchor" id="line-155"></span><span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span><span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span><span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span><span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span><span class="anchor" id="line-167"></span><span class="anchor" id="line-168"></span><span class="anchor" id="line-169"></span><span class="anchor" id="line-170"></span><span class="anchor" id="line-171"></span><span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span><span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span><span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><span class="anchor" id="line-178"></span><span class="anchor" id="line-179"></span><span class="anchor" id="line-180"></span><span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span><span class="anchor" id="line-183"></span><span class="anchor" id="line-184"></span><span class="anchor" id="line-185"></span><span class="anchor" id="line-1-5"></span></p><div class="highlight c"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-f22af37102c9c2ede7b0dbc72d62a70c547adb7e" lang="en"><span class="line"><span class="anchor" id="line-1-6"></span><span class="ResWord">static</span> <span class="ID">gboolean</span></span>
<span class="line"><span class="anchor" id="line-2-3"></span><span class="ID">bar_application_dbus_register</span> (<span class="ID">GApplication</span> *<span class="ID">application</span>,</span>
<span class="line"><span class="anchor" id="line-3-3"></span>                               <span class="ID">GDBusConnection</span> *<span class="ID">connection</span>,</span>
<span class="line"><span class="anchor" id="line-4-3"></span>                               <span class="ResWord">const</span> <span class="ID">gchar</span> *<span class="ID">object_path</span>,</span>
<span class="line"><span class="anchor" id="line-5-3"></span>                               <span class="ID">GError</span> **<span class="ID">error</span>)</span>
<span class="line"><span class="anchor" id="line-6-3"></span>{</span>
<span class="line"><span class="anchor" id="line-7-3"></span>  <span class="ID">BarApplication</span> *<span class="ID">self</span> = <span class="ID">BAR_APPLICATION</span> (<span class="ID">application</span>);</span>
<span class="line"><span class="anchor" id="line-8-3"></span>  <span class="ID">gboolean</span> <span class="ID">ret_val</span> = <span class="ID">FALSE</span>;</span>
<span class="line"><span class="anchor" id="line-9-3"></span>  <span class="ID">gchar</span> *<span class="ID">search_provider_path</span> = <span class="ResWord">NULL</span>;</span>
<span class="line"><span class="anchor" id="line-10-3"></span></span>
<span class="line"><span class="anchor" id="line-11-3"></span>  <span class="ResWord">if</span> (!<span class="ID">G_APPLICATION_CLASS</span> (<span class="ID">bar_application_parent_class</span>)</span>
<span class="line"><span class="anchor" id="line-12-3"></span>         -&gt;<span class="ID">dbus_register</span> (<span class="ID">application</span>,</span>
<span class="line"><span class="anchor" id="line-13-3"></span>                          <span class="ID">connection</span>,</span>
<span class="line"><span class="anchor" id="line-14-3"></span>                          <span class="ID">object_path</span>,</span>
<span class="line"><span class="anchor" id="line-15-3"></span>                          <span class="ID">error</span>))</span>
<span class="line"><span class="anchor" id="line-16-3"></span>    <span class="ResWord">goto</span> <span class="ID">out</span>;</span>
<span class="line"><span class="anchor" id="line-17-3"></span></span>
<span class="line"><span class="anchor" id="line-18-3"></span>  <span class="ID">search_provider_path</span> = <span class="ID">g_strconcat</span> (<span class="ID">object_path</span>, <span class="String">"</span><span class="String">/SearchProvider</span><span class="String">"</span>, <span class="ResWord">NULL</span>);</span>
<span class="line"><span class="anchor" id="line-19-2"></span>  <span class="ResWord">if</span> (!<span class="ID">bar_search_provider_dbus_export</span> (<span class="ID">self</span>-&gt;<span class="ID">search_provider</span>,</span>
<span class="line"><span class="anchor" id="line-20-2"></span>                                        <span class="ID">connection</span>,</span>
<span class="line"><span class="anchor" id="line-21-2"></span>                                        <span class="ID">search_provider_path</span>,</span>
<span class="line"><span class="anchor" id="line-22-2"></span>                                        <span class="ID">error</span>))</span>
<span class="line"><span class="anchor" id="line-23-2"></span>    <span class="ResWord">goto</span> <span class="ID">out</span>;</span>
<span class="line"><span class="anchor" id="line-24-2"></span></span>
<span class="line"><span class="anchor" id="line-25-2"></span>  <span class="ID">ret_val</span> = <span class="ID">TRUE</span>;</span>
<span class="line"><span class="anchor" id="line-26-2"></span></span>
<span class="line"><span class="anchor" id="line-27-2"></span> <span class="ID">out</span>:</span>
<span class="line"><span class="anchor" id="line-28-2"></span>  <span class="ID">g_free</span> (<span class="ID">search_provider_path</span>);</span>
<span class="line"><span class="anchor" id="line-29-2"></span>  <span class="ResWord">return</span> <span class="ID">ret_val</span>;</span>
<span class="line"><span class="anchor" id="line-30-2"></span>}</span>
</pre></div></div><span class="anchor" id="line-186"></span><span class="anchor" id="line-187"></span><p class="line874">And then removed during cleanup: <span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span></p><p class="line867"><span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span><span class="anchor" id="line-192"></span><span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span><span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span><span class="anchor" id="line-197"></span><span class="anchor" id="line-198"></span><span class="anchor" id="line-199"></span><span class="anchor" id="line-200"></span><span class="anchor" id="line-201"></span><span class="anchor" id="line-202"></span><span class="anchor" id="line-203"></span><span class="anchor" id="line-204"></span><span class="anchor" id="line-205"></span><span class="anchor" id="line-206"></span><span class="anchor" id="line-207"></span><span class="anchor" id="line-208"></span><span class="anchor" id="line-209"></span><span class="anchor" id="line-210"></span><span class="anchor" id="line-1-7"></span></p><div class="highlight c"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-41ca052e8136657c5a47b62110067d4fc3253eac" lang="en"><span class="line"><span class="anchor" id="line-1-8"></span><span class="ResWord">static</span> <span class="ResWord">void</span></span>
<span class="line"><span class="anchor" id="line-2-4"></span><span class="ID">bar_application_dbus_unregister</span> (<span class="ID">GApplication</span> *<span class="ID">application</span>,</span>
<span class="line"><span class="anchor" id="line-3-4"></span>                                 <span class="ID">GDBusConnection</span> *<span class="ID">connection</span>,</span>
<span class="line"><span class="anchor" id="line-4-4"></span>                                 <span class="ResWord">const</span> <span class="ID">gchar</span> *<span class="ID">object_path</span>)</span>
<span class="line"><span class="anchor" id="line-5-4"></span>{</span>
<span class="line"><span class="anchor" id="line-6-4"></span>  <span class="ID">BarApplication</span> *<span class="ID">self</span> = <span class="ID">BAR_APPLICATION</span> (<span class="ID">application</span>);</span>
<span class="line"><span class="anchor" id="line-7-4"></span>  <span class="ID">gchar</span> *<span class="ID">search_provider_path</span> = <span class="ResWord">NULL</span>;</span>
<span class="line"><span class="anchor" id="line-8-4"></span></span>
<span class="line"><span class="anchor" id="line-9-4"></span>  <span class="ID">search_provider_path</span> = <span class="ID">g_strconcat</span> (<span class="ID">object_path</span>, <span class="String">"</span><span class="String">/SearchProvider</span><span class="String">"</span>, <span class="ResWord">NULL</span>);</span>
<span class="line"><span class="anchor" id="line-10-4"></span>  <span class="ID">bar_search_provider_dbus_unexport</span> (<span class="ID">self</span>-&gt;<span class="ID">search_provider</span>,</span>
<span class="line"><span class="anchor" id="line-11-4"></span>                                     <span class="ID">connection</span>,</span>
<span class="line"><span class="anchor" id="line-12-4"></span>                                     <span class="ID">search_provider_path</span>);</span>
<span class="line"><span class="anchor" id="line-13-4"></span></span>
<span class="line"><span class="anchor" id="line-14-4"></span>  <span class="ID">G_APPLICATION_CLASS</span> (<span class="ID">bar_application_parent_class</span>)</span>
<span class="line"><span class="anchor" id="line-15-4"></span>    -&gt;<span class="ID">dbus_unregister</span> (<span class="ID">application</span>,</span>
<span class="line"><span class="anchor" id="line-16-4"></span>                       <span class="ID">connection</span>,</span>
<span class="line"><span class="anchor" id="line-17-4"></span>                       <span class="ID">object_path</span>);</span>
<span class="line"><span class="anchor" id="line-18-4"></span></span>
<span class="line"><span class="anchor" id="line-19-3"></span>  <span class="ID">g_free</span> (<span class="ID">search_provider_path</span>);</span>
<span class="line"><span class="anchor" id="line-20-3"></span>}</span>
</pre></div></div><span class="anchor" id="line-211"></span><span class="anchor" id="line-212"></span><p class="line862">You can generate a <a class="https" href="https://developer.gnome.org/gio/stable/GDBusInterfaceSkeleton.html">GDBusInterfaceSkeleton</a> that implements the org.gnome.ShellSearchProvider2 interface using <a class="https" href="https://developer.gnome.org/gio/stable/gdbus-codegen.html">gdbus-codegen</a> in Makefile.am: <span class="anchor" id="line-213"></span><span class="anchor" id="line-214"></span></p><p class="line867"><span class="anchor" id="line-215"></span><span class="anchor" id="line-216"></span><span class="anchor" id="line-217"></span><span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span><span class="anchor" id="line-220"></span><span class="anchor" id="line-221"></span><span class="anchor" id="line-222"></span></p><pre><span class="anchor" id="line-1-6"></span>shell-search-provider2.h shell-search-provider2.c: org.gnome.ShellSearchProvider2.xml
<span class="anchor" id="line-2-1"></span>        $(AM_V_GEN)gdbus-codegen \
<span class="anchor" id="line-3-1"></span>                --c-namespace Shell \
<span class="anchor" id="line-4-1"></span>                --generate-c-code shell-search-provider2 \
<span class="anchor" id="line-5-1"></span>                --interface-prefix org.gnome.Shell. \
<span class="anchor" id="line-6"></span>                $&lt;</pre><span class="anchor" id="line-223"></span><span class="anchor" id="line-224"></span><p class="line862">You can either depend on GNOME Shell to provide the D-Bus interface definition in org.gnome.ShellSearchProvider2.xml or copy it into your source tree. <span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span></p><p class="line862">This is then used in BarSearchProvider which has the guts of the search provider implementation: <span class="anchor" id="line-227"></span><span class="anchor" id="line-228"></span></p><p class="line867"><span class="anchor" id="line-229"></span><span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span><span class="anchor" id="line-232"></span><span class="anchor" id="line-233"></span><span class="anchor" id="line-234"></span><span class="anchor" id="line-235"></span><span class="anchor" id="line-236"></span><span class="anchor" id="line-237"></span><span class="anchor" id="line-238"></span><span class="anchor" id="line-239"></span><span class="anchor" id="line-240"></span><span class="anchor" id="line-241"></span><span class="anchor" id="line-242"></span><span class="anchor" id="line-243"></span><span class="anchor" id="line-244"></span><span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span><span class="anchor" id="line-247"></span><span class="anchor" id="line-248"></span><span class="anchor" id="line-249"></span><span class="anchor" id="line-250"></span><span class="anchor" id="line-251"></span><span class="anchor" id="line-252"></span><span class="anchor" id="line-253"></span><span class="anchor" id="line-254"></span><span class="anchor" id="line-255"></span><span class="anchor" id="line-256"></span><span class="anchor" id="line-257"></span><span class="anchor" id="line-258"></span><span class="anchor" id="line-259"></span><span class="anchor" id="line-260"></span><span class="anchor" id="line-261"></span><span class="anchor" id="line-262"></span><span class="anchor" id="line-263"></span><span class="anchor" id="line-264"></span><span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span><span class="anchor" id="line-267"></span><span class="anchor" id="line-268"></span><span class="anchor" id="line-1-9"></span></p><div class="highlight c"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-ae9fa7f3e120c8765ba950949b04ce9c1bbcd0f8" lang="en"><span class="line"><span class="anchor" id="line-1-10"></span><span class="ResWord">struct</span> <span class="ID">_BarSearchProvider</span></span>
<span class="line"><span class="anchor" id="line-2-5"></span>{</span>
<span class="line"><span class="anchor" id="line-3-5"></span>  <span class="ID">GObject</span> <span class="ID">parent_instance</span>;</span>
<span class="line"><span class="anchor" id="line-4-5"></span>  <span class="ID">ShellSearchProvider2</span> *<span class="ID">skeleton</span>;</span>
<span class="line"><span class="anchor" id="line-5-5"></span>};</span>
<span class="line"><span class="anchor" id="line-6-5"></span></span>
<span class="line"><span class="anchor" id="line-7-5"></span><span class="ResWord">struct</span> <span class="ID">_BarSearchProviderClass</span></span>
<span class="line"><span class="anchor" id="line-8-5"></span>{</span>
<span class="line"><span class="anchor" id="line-9-5"></span>  <span class="ID">GObjectClass</span> <span class="ID">parent_class</span>;</span>
<span class="line"><span class="anchor" id="line-10-5"></span>};</span>
<span class="line"><span class="anchor" id="line-11-5"></span></span>
<span class="line"><span class="anchor" id="line-12-5"></span><span class="ID">G_DEFINE_TYPE</span> (<span class="ID">BarSearchProvider</span>, <span class="ID">bar_search_provider</span>, <span class="ID">G_TYPE_OBJECT</span>);</span>
<span class="line"><span class="anchor" id="line-13-5"></span></span>
<span class="line"><span class="anchor" id="line-14-5"></span><span class="ResWord">static</span> <span class="ResWord">void</span></span>
<span class="line"><span class="anchor" id="line-15-5"></span><span class="ID">bar_search_provider_init</span> (<span class="ID">BarSearchProvider</span> *<span class="ID">self</span>)</span>
<span class="line"><span class="anchor" id="line-16-5"></span>{</span>
<span class="line"><span class="anchor" id="line-17-5"></span>  <span class="ID">self</span>-&gt;<span class="ID">skeleton</span> = <span class="ID">shell_search_provider2_skeleton_new</span> ();</span>
<span class="line"><span class="anchor" id="line-18-5"></span></span>
<span class="line"><span class="anchor" id="line-19-4"></span>  <span class="ID">g_signal_connect_swapped</span> (<span class="ID">self</span>-&gt;<span class="ID">skeleton</span>,</span>
<span class="line"><span class="anchor" id="line-20-4"></span>                            <span class="String">"</span><span class="String">handle-activate-result</span><span class="String">"</span>,</span>
<span class="line"><span class="anchor" id="line-21-3"></span>                            <span class="ID">G_CALLBACK</span> (<span class="ID">bar_search_provider_activate_result</span>),</span>
<span class="line"><span class="anchor" id="line-22-3"></span>                            <span class="ID">self</span>);</span>
<span class="line"><span class="anchor" id="line-23-3"></span>  <span class="ID">g_signal_connect_swapped</span> (<span class="ID">self</span>-&gt;<span class="ID">skeleton</span>,</span>
<span class="line"><span class="anchor" id="line-24-3"></span>                            <span class="String">"</span><span class="String">handle-get-initial-result-set</span><span class="String">"</span>,</span>
<span class="line"><span class="anchor" id="line-25-3"></span>                            <span class="ID">G_CALLBACK</span> (<span class="ID">bar_search_provider_get_initial_result_set</span>),</span>
<span class="line"><span class="anchor" id="line-26-3"></span>                            <span class="ID">self</span>);</span>
<span class="line"><span class="anchor" id="line-27-3"></span>  <span class="ID">g_signal_connect_swapped</span> (<span class="ID">self</span>-&gt;<span class="ID">skeleton</span>,</span>
<span class="line"><span class="anchor" id="line-28-3"></span>                            <span class="String">"</span><span class="String">handle-get-subsearch-result-set</span><span class="String">"</span>,</span>
<span class="line"><span class="anchor" id="line-29-3"></span>                            <span class="ID">G_CALLBACK</span> (<span class="ID">bar_search_provider_get_subsearch_result_set</span>),</span>
<span class="line"><span class="anchor" id="line-30-3"></span>                            <span class="ID">self</span>);</span>
<span class="line"><span class="anchor" id="line-31-2"></span>  <span class="ID">g_signal_connect_swapped</span> (<span class="ID">self</span>-&gt;<span class="ID">skeleton</span>,</span>
<span class="line"><span class="anchor" id="line-32-2"></span>                            <span class="String">"</span><span class="String">handle-get-result-metas</span><span class="String">"</span>,</span>
<span class="line"><span class="anchor" id="line-33-1"></span>                            <span class="ID">G_CALLBACK</span> (<span class="ID">bar_search_provider_get_result_metas</span>),</span>
<span class="line"><span class="anchor" id="line-34-1"></span>                            <span class="ID">self</span>);</span>
<span class="line"><span class="anchor" id="line-35-1"></span>  <span class="ID">g_signal_connect_swapped</span> (<span class="ID">self</span>-&gt;<span class="ID">skeleton</span>,</span>
<span class="line"><span class="anchor" id="line-36-1"></span>                            <span class="String">"</span><span class="String">handle-launch-search</span><span class="String">"</span>,</span>
<span class="line"><span class="anchor" id="line-37-1"></span>                            <span class="ID">G_CALLBACK</span> (<span class="ID">bar_search_provider_launch_search</span>),</span>
<span class="line"><span class="anchor" id="line-38-1"></span>                            <span class="ID">self</span>);</span>
<span class="line"><span class="anchor" id="line-39-1"></span>}</span>
</pre></div></div><span class="anchor" id="line-269"></span><span class="anchor" id="line-270"></span><p class="line862">If your D-Bus method handlers are asynchronous, then you should hold a reference to BarApplication using <a class="https" href="https://developer.gnome.org/gio/stable/GApplication.html#g-application-hold">g_application_hold</a> and g_application_release it when you are done. Use the corresponding shell_search_provider2_complete* methods to indicate completion and send back results, if any. <span class="anchor" id="line-271"></span><span class="anchor" id="line-272"></span></p><p class="line874">Convenience wrapper methods to export and unexport the skeleton: <span class="anchor" id="line-273"></span><span class="anchor" id="line-274"></span></p><p class="line867"><span class="anchor" id="line-275"></span><span class="anchor" id="line-276"></span><span class="anchor" id="line-277"></span><span class="anchor" id="line-278"></span><span class="anchor" id="line-279"></span><span class="anchor" id="line-280"></span><span class="anchor" id="line-281"></span><span class="anchor" id="line-282"></span><span class="anchor" id="line-283"></span><span class="anchor" id="line-284"></span><span class="anchor" id="line-285"></span><span class="anchor" id="line-286"></span><span class="anchor" id="line-287"></span><span class="anchor" id="line-288"></span><span class="anchor" id="line-289"></span><span class="anchor" id="line-290"></span><span class="anchor" id="line-291"></span><span class="anchor" id="line-292"></span><span class="anchor" id="line-293"></span><span class="anchor" id="line-294"></span><span class="anchor" id="line-295"></span><span class="anchor" id="line-296"></span><span class="anchor" id="line-297"></span><span class="anchor" id="line-298"></span><span class="anchor" id="line-299"></span><span class="anchor" id="line-300"></span><span class="anchor" id="line-301"></span><span class="anchor" id="line-302"></span><span class="anchor" id="line-1-11"></span></p><div class="highlight c"><div class="codearea" dir="ltr" lang="en"><pre dir="ltr" id="CA-15d05f0baa016963501a01d0f224c1e427a3b45c" lang="en"><span class="line"><span class="anchor" id="line-1-12"></span><span class="ID">gboolean</span></span>
<span class="line"><span class="anchor" id="line-2-6"></span><span class="ID">bar_search_provider_dbus_export</span> (<span class="ID">BarSearchProvider</span> *<span class="ID">self</span>,</span>
<span class="line"><span class="anchor" id="line-3-6"></span>                                 <span class="ID">GDBusConnection</span> *<span class="ID">connection</span>,</span>
<span class="line"><span class="anchor" id="line-4-6"></span>                                 <span class="ResWord">const</span> <span class="ID">gchar</span> *<span class="ID">object_path</span>,</span>
<span class="line"><span class="anchor" id="line-5-6"></span>                                 <span class="ID">GError</span> **<span class="ID">error</span>)</span>
<span class="line"><span class="anchor" id="line-6-6"></span>{</span>
<span class="line"><span class="anchor" id="line-7-6"></span>  <span class="ResWord">return</span> <span class="ID">g_dbus_interface_skeleton_export</span> (</span>
<span class="line"><span class="anchor" id="line-8-6"></span>           <span class="ID">G_DBUS_INTERFACE_SKELETON</span> (<span class="ID">self</span>-&gt;<span class="ID">skeleton</span>),</span>
<span class="line"><span class="anchor" id="line-9-6"></span>           <span class="ID">connection</span>,</span>
<span class="line"><span class="anchor" id="line-10-6"></span>           <span class="ID">object_path</span>,</span>
<span class="line"><span class="anchor" id="line-11-6"></span>           <span class="ID">error</span>);</span>
<span class="line"><span class="anchor" id="line-12-6"></span>}</span>
<span class="line"><span class="anchor" id="line-13-6"></span></span>
<span class="line"><span class="anchor" id="line-14-6"></span><span class="ResWord">void</span></span>
<span class="line"><span class="anchor" id="line-15-6"></span><span class="ID">bar_search_provider_dbus_unexport</span> (<span class="ID">BarSearchProvider</span> *<span class="ID">self</span>,</span>
<span class="line"><span class="anchor" id="line-16-6"></span>                                   <span class="ID">GDBusConnection</span> *<span class="ID">connection</span>,</span>
<span class="line"><span class="anchor" id="line-17-6"></span>                                   <span class="ResWord">const</span> <span class="ID">gchar</span> *<span class="ID">object_path</span>)</span>
<span class="line"><span class="anchor" id="line-18-6"></span>{</span>
<span class="line"><span class="anchor" id="line-19-5"></span>  <span class="ResWord">if</span> (<span class="ID">g_dbus_interface_skeleton_has_connection</span> (</span>
<span class="line"><span class="anchor" id="line-20-5"></span>        <span class="ID">G_DBUS_INTERFACE_SKELETON</span> (<span class="ID">self</span>-&gt;<span class="ID">skeleton</span>),</span>
<span class="line"><span class="anchor" id="line-21-4"></span>        <span class="ID">connection</span>))</span>
<span class="line"><span class="anchor" id="line-22-4"></span>    {</span>
<span class="line"><span class="anchor" id="line-23-4"></span>      <span class="ID">g_dbus_interface_skeleton_unexport_from_connection</span> (</span>
<span class="line"><span class="anchor" id="line-24-4"></span>        <span class="ID">G_DBUS_INTERFACE_SKELETON</span> (<span class="ID">self</span>-&gt;<span class="ID">skeleton</span>),</span>
<span class="line"><span class="anchor" id="line-25-4"></span>        <span class="ID">connection</span>);</span>
<span class="line"><span class="anchor" id="line-26-4"></span>    }</span>
<span class="line"><span class="anchor" id="line-27-4"></span>}</span>
</pre></div></div><span class="anchor" id="line-303"></span><span class="anchor" id="line-304"></span><p class="line867">
</p><h2 id="Examples">Examples</h2>
<span class="anchor" id="line-305"></span><span class="anchor" id="line-306"></span><p class="line874">Many GNOME application have search providers, here are some examples you can study: <span class="anchor" id="line-307"></span></p><ul><li><p class="line862">Files, <a class="https" href="https://gitlab.gnome.org/GNOME/nautilus/blob/master/src/nautilus-shell-search-provider.c">in C</a> <span class="anchor" id="line-308"></span></p></li><li><p class="line862">Clocks, <a class="https" href="https://gitlab.gnome.org/GNOME/gnome-clocks/blob/master/src/search-provider.vala">in vala</a> <span class="anchor" id="line-309"></span></p></li><li><p class="line862">Weather, <a class="https" href="https://gitlab.gnome.org/GNOME/gnome-weather/blob/master/src/service/searchProvider.js">in JavaScript</a> <span class="anchor" id="line-310"></span></p></li></ul><span class="anchor" id="bottom"></span></div></div><div id="footer_art" class="default"> </div></div><div class="clearfix"></div><div id="footer_grass">   </div><div id="footer"><div class="container_12"><div class="links grid_9"><div class="menu-footer-1-container"><ul id="menu-footer-1" class="menu"><li id="menu-item-88" class="menu-item menu-item-type-custom menu-item-home menu-item-88"><a href="https://www.gnome.org/">The GNOME Project</a><ul class="sub-menu"><li id="menu-item-89" class="menu-item menu-item-type-post_type menu-item-89"><a href="https://www.gnome.org/about/">About Us</a></li><li id="menu-item-90" class="menu-item menu-item-type-custom menu-item-90"><a href="https://www.gnome.org/get-involved/">Get Involved</a></li><li id="menu-item-91" class="menu-item menu-item-type-custom menu-item-91"><a href="https://www.gnome.org/teams/">Teams</a></li><li id="menu-item-92" class="menu-item menu-item-type-custom menu-item-92"><a href="https://foundation.gnome.org">The GNOME Foundation</a></li><li><a href="https://www.gnome.org/support-gnome/">Support GNOME</a></li><li><a href="https://www.gnome.org/contact/">Contact</a></li></ul></li></ul></div><div class="menu-footer-2-container"><ul id="menu-footer-2" class="menu"><li id="menu-item-99" class="menu-item menu-item-type-post_type current-menu-item page_item page-item-20 current_page_item menu-item-99"><a href="index.html#">Resources</a><ul class="sub-menu"><li><a href="https://help.gnome.org">Documentation</a></li><li><a href="https://wiki.gnome.org">Wiki</a></li><li><a href="https://mail.gnome.org/mailman/listinfo">Mailing Lists</a></li><li><a href="https://wiki.gnome.org/GnomeIrcChannels">IRC Channels</a></li><li><a href="https://gitlab.gnome.org/">Bug Tracker</a></li><li><a href="https://gitlab.gnome.org/">Development Code</a></li><li><a href="https://wiki.gnome.org/Jhbuild">Build Tool</a></li></ul></li></ul></div><div class="menu-footer-4-container"><ul id="menu-footer-4" class="menu"><li id="menu-item-104" class="menu-item menu-item-type-custom menu-item-104"><a href="http://www.gnome.org/news/">News</a><ul class="sub-menu"><li><a href="https://www.gnome.org/start/stable">Latest Release</a></li><li><a href="https://planet.gnome.org">Planet GNOME</a></li><li><a href="https://news.gnome.org">Development News</a></li><li><a href="https://twitter.com/gnome">Twitter</a></li></ul></li></ul></div></div><div class="links grid_3 right"><div><ul class="menu available_languages"><li><strong>This website is available in many languages</strong><ul class="sub-menu"><li><a href="../languages.html" title="Switching Language">Switch Language</a></li></ul></li></ul><script type="text/javascript" src="../js/language.js"></script></div></div><div id="footnotes" class="grid_9">
                Copyright © 2005‒2014 <strong class="gnome_logo">The GNOME Project</strong><br></br><small>Optimised for standards. Hosted by <a href="http://redhat.com">Red Hat</a>.</small></div><div class="clear"></div></div></div><script type="text/javascript">
$(document).ready(function() {
    // Get browser
    $.each($.browser, function(i) {
        $('body').addClass(i);
        return false;
    });

    // Get OS and add it as class to body tag, this then allows forcing some
    // customisation in the CSS rules.
    var match = navigator.userAgent.toLowerCase().match(/(win|mac|linux)/);
    if (match) {
        $('body').addClass(match[0]);
    }
});
</script><script type="text/javascript">
      var _paq = _paq || [];
      _paq.push(['disableCookies']);
      _paq.push(["trackPageView"]);
      _paq.push(["enableLinkTracking"]);

      (function() {
        var u=(("https:" == document.location.protocol) ? "https" : "http") + "://webstats.gnome.org/";
        _paq.push(["setTrackerUrl", u+"piwik.php"]);
        _paq.push(["setSiteId", "6"]);
        var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";
        g.defer=true; g.async=true; g.src=u+"piwik.js"; s.parentNode.insertBefore(g,s);
      })();
    </script></body></html>
