<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:html="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="text/html; charset=utf-8"></meta><link rel="stylesheet" type="text/css" media="all" href="https://static.gnome.org/css/grass-theme-style.css"></link><link rel="stylesheet" type="text/css" media="all" href="../skin/lgo2010.css"></link><link rel="icon" type="image/png" href="../skin/gnome-16.png"></link><link rel="SHORTCUT ICON" type="image/png" href="../skin/gnome-16.png"></link><link rel="search" type="application/opensearchdescription+xml" href="../gnome-library-search.xml" title="GNOME Library Search"></link><link rel="stylesheet" href="../skin/moinmoin.css" type="text/css"></link><title>HowDoI/AlternateMenubarLayout - GNOME Wiki!</title><link href="https://wiki.gnome.org/action/rss_rc/HowDoI/AlternateMenubarLayout?diffs=1&amp;show_att=1&amp;action=rss_rc&amp;unique=0&amp;page=HowDoI%2FAlternateMenubarLayout&amp;ddiffs=1" rel="alternate" title="GNOME Wiki!: HowDoI/AlternateMenubarLayout" type="application/rss+xml"></link><link href="https://wiki.gnome.org/Home" rel="Start"></link><link href="https://wiki.gnome.org/action/raw/HowDoI/AlternateMenubarLayout?action=raw" rel="Alternate" title="Wiki Markup"></link><link href="https://wiki.gnome.org/action/print/HowDoI/AlternateMenubarLayout?action=print" media="print" rel="Alternate" title="Print View"></link><link href="https://wiki.gnome.org/HowDoI" rel="Up"></link><link href="https://wiki.gnome.org/FindPage" rel="Search"></link><link href="https://wiki.gnome.org/TitleIndex" rel="Index"></link><link href="https://wiki.gnome.org/WordIndex" rel="Glossary"></link><link href="https://wiki.gnome.org/HelpOnFormatting" rel="Help"></link><link rel="stylesheet" type="text/css" media="all" href="../skin/jquery.autocomplete.css"></link><link rel="stylesheet" type="text/css" media="all" href="../skin/960_24_col.css"></link><script type="text/javascript" src="../js/jquery.js"></script><script type="text/javascript" src="https://developer-old.gnome.org/js/jquery.jcarousel.min.js"></script><script type="text/javascript" src="../js/jquery.autocomplete.js"></script></head><body><div id="accessibility_access"><ul><li><a href="index.html#container">Go to page content</a></li><li><a href="index.html#top_bar">Go to main menu</a></li><li><a href="index.html#s" onclick="$('#s').focus(); return false;">Go to the search field</a></li></ul></div><div id="global_domain_bar"><div class="maxwidth"><div class="tab"><a class="root" href="https://www.gnome.org/">GNOME.org</a></div></div></div><div id="header" class="container_12"><div id="logo" class="grid_3"><a title="Go to home page" href="../index.html"><img alt="GNOME: The Free Software Desktop Project" src="../skin/gnome-logo-devcenter.png"></img></a></div><div id="top_bar" class="grid_9"><div class="left"><div class="menu-globalnav-container"><ul id="menu-globalnav" class="menu"><li class="menu-item menu-item-type-post_type menu-item-6"><a href="../about/index.html">About</a></li><li class="menu-item menu-item-type-post_type menu-item-23"><a href="https://help.gnome.org/users/">Users</a></li><li class="menu-item menu-item-type-post_type menu-item-40"><a href="https://help.gnome.org/admin/">Administrators</a></li><li class="current-menu-item"><a href="https://developer.gnome.org/">Developers</a></li></ul></div></div><div class="right"><form role="search" method="get" id="searchform" action="https://developer-old.gnome.org/search"><div><label class="hidden" for="q">Search:
                        </label><input type="text" value="" name="q" id="s" placeholder="Search"></input></div></form></div></div></div><div class="clearfix"></div><div id="container" class="content-id"><div class="content"><div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867">
</p><h1 id="Alternate_menubar_layout">Alternate menubar layout</h1>
<span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line867"><img alt="/!\" height="16" src="https://wiki.gnome.org/gnome/gnome-responsive/img/dialog-warning-symbolic.png" title="/!\" width="16"></img> This is currently a proposal (and incomplete, at that).  This is not an official recommendation for GNOME applications. <span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span></p><p class="line867">
</p><h2 id="Use_cases">Use cases</h2>
<span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><p class="line874">These are the different types of situations that an application may find itself in with respect to the user's desired menu layout: <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span></p><ul><li>GNOME 3 <span class="anchor" id="line-10"></span></li><li>"new" GNOME 2/Windows/KDE style (no way to display an appmenu, but still prefer menu buttons to menubars) <span class="anchor" id="line-11"></span></li><li>"oldschool" GNOME 2/MATE/Windows/KDE style (ie: prefer menubars to menu buttons) <span class="anchor" id="line-12"></span></li><li>Mac OS <span class="anchor" id="line-13"></span></li><li>Unity (prefer oldschool menubar at the top) <span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span></li></ul><p class="line874">"Old school" here means the traditional File/Edit/View/Help type of menubar layout. <span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span></p><p class="line874">The instructions below are only helpful for the case of an app that wants to work in GNOME 3 but wants to use the toplevel menubar when in Mac OS.  They are also partially applicable to Unity, but Unity tends to prefer that applications use an "oldschool" menu layout, and skip the appmenu entirely (which is not handled here). <span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span></p><p class="line867">
</p><h2 id="Current_instructions">Current instructions</h2>
<span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><p class="line874">This page attempts to roughly document a proposal for how applications should deal with providing an alternate menubar layout for running under Unity or Mac OS. <span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span></p><p class="line862">Both of these platforms have a menubar at the top of the screen that users expect to contain the menus of the running application.  <a class="nonexistent" href="https://wiki.gnome.org/GtkMenuButton">GtkMenuButton</a>-in-<a class="nonexistent" href="https://wiki.gnome.org/GtkHeaderBar">GtkHeaderBar</a> menus don't make much sense in this context. <span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span></p><p class="line874">The approach is fairly simple: <span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span></p><ul><li><p class="line862">ensure all <a class="nonexistent" href="https://wiki.gnome.org/GtkMenuButton">GtkMenuButton</a> menus are defined via GMenuModel <span class="anchor" id="line-28"></span></p></li><li>define an alternate menubar layout <span class="anchor" id="line-29"></span></li><li>prevent the alternate menubar from ever being shown locally <span class="anchor" id="line-30"></span></li><li>hide headerbar content when the alternate menubar is shown on Unity or Mac OS <span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span></li></ul><p class="line867">
</p><h2 id="Use_GMenuModel_for_all_GtkMenuButton_menus">Use GMenuModel for all GtkMenuButton menus</h2>
<span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><p class="line862">This is pretty straightforward.  If you're not already doing so, probably you want to construct the GMenu with <a class="nonexistent" href="https://wiki.gnome.org/GtkBuilder">GtkBuilder</a>. <span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span></p><p class="line862">The reason that you want to do this is because all functionality that can be hit from your <a class="nonexistent" href="https://wiki.gnome.org/GtkMenuButton">GtkMenuButton</a> menus should be in the form of GAction so that these actions can also be hit from the equivalent items in the alternative menubar layout. <span class="anchor" id="line-37"></span><span class="anchor" id="line-38"></span></p><p class="line867">
</p><h2 id="Define_an_alternate_menubar">Define an alternate menubar</h2>
<span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><p class="line862">You should define a menubar layout using GMenu-in-<a class="nonexistent" href="https://wiki.gnome.org/GtkBuilder">GtkBuilder</a>.  In many cases, this will already exist in older versions of the app in question (before it was changed to use <a class="nonexistent" href="https://wiki.gnome.org/GtkMenuButton">GtkMenuButton</a>). <span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span></p><p class="line862">You must (manually) ensure that the content of the alternative menubar is kept to feature parity with the menus attached to <a class="nonexistent" href="https://wiki.gnome.org/GtkMenuButtons">GtkMenuButtons</a> that you will hide in order that all features of the application are available on all platforms.  This is perhaps the weakest point of this proposal -- having to remember to update menus in two places. <span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span></p><p class="line862">Because all functionality that would have been accessible from the <a class="nonexistent" href="https://wiki.gnome.org/GtkHeaderBar">GtkHeaderBar</a> menus is in the form of actions, you simply have to use the same action names to hit that functionality. <span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span></p><p class="line862">Set this menubar on your <a class="nonexistent" href="https://wiki.gnome.org/GtkApplication">GtkApplication</a> using gtk_application_set_menubar(). <span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span></p><p class="line867">
</p><h2 id="Hide_the_local_menubar">Hide the local menubar</h2>
<span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><p class="line862">Normally, when using gtk_application_set_menubar() the menubar would be shown locally inside of each window.  Because the functionality is already provided by the <a class="nonexistent" href="https://wiki.gnome.org/GtkHeaderBar">GtkHeaderBar</a>, we want to suppress this.  This menu should only ever be shown outside of the window. <span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span></p><p class="line862">The way to accomplish that is via the "show-menubar" property on <a class="nonexistent" href="https://wiki.gnome.org/GtkApplicationWindow">GtkApplicationWindow</a>.  Call gtk_application_window_set_show_menubar() to set that to FALSE (or pass an initial value for the property to your g_object_new() call, if subclassing). <span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span></p><p class="line867">
</p><h2 id="Conditionally_hide_headerbar_content">Conditionally hide headerbar content</h2>
<span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><p class="line874">Since the menu is never shown locally, we only want to hide the headerbar content in the case that the menu is shown remotely by a desktop environment like Unity or Mac OS. <span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span></p><p class="line862">Fortunately, we have a relatively easy way to determine when this is the case -- the "gtk-shell-shows-menubar" property on <a class="nonexistent" href="https://wiki.gnome.org/GtkSettings">GtkSettings</a>.  GObject property bindings are your friend here. <span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span></p><p class="line874">Assuming you have a widget like "menu_button", do something like this: <span class="anchor" id="line-61"></span><span class="anchor" id="line-62"></span></p><p class="line867"><span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span></p><pre><span class="anchor" id="line-1"></span>   GtkSettings *settings;
<span class="anchor" id="line-2"></span>   GtkWidget *menu_button;
<span class="anchor" id="line-3"></span>
<span class="anchor" id="line-4"></span>   menu_button = (GtkWidget *) gtk_builder_get_object (builder, "menu-button");
<span class="anchor" id="line-5"></span>   settings = gtk_settings_get_default ();
<span class="anchor" id="line-6"></span>   g_object_bind_property (settings, "gtk-shell-shows-menubar",
<span class="anchor" id="line-7"></span>                           menu_button, "visible",
<span class="anchor" id="line-8"></span>                           G_BINDING_INVERT_BOOLEAN);</pre><span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><p class="line874">We invert the boolean because we want the menu button to be visible when the menubar is not visible. <span class="anchor" id="line-74"></span><span class="anchor" id="bottom"></span></p></div></div><div id="footer_art" class="default"> </div></div><div class="clearfix"></div><div id="footer_grass">   </div><div id="footer"><div class="container_12"><div class="links grid_9"><div class="menu-footer-1-container"><ul id="menu-footer-1" class="menu"><li id="menu-item-88" class="menu-item menu-item-type-custom menu-item-home menu-item-88"><a href="https://www.gnome.org/">The GNOME Project</a><ul class="sub-menu"><li id="menu-item-89" class="menu-item menu-item-type-post_type menu-item-89"><a href="https://www.gnome.org/about/">About Us</a></li><li id="menu-item-90" class="menu-item menu-item-type-custom menu-item-90"><a href="https://www.gnome.org/get-involved/">Get Involved</a></li><li id="menu-item-91" class="menu-item menu-item-type-custom menu-item-91"><a href="https://www.gnome.org/teams/">Teams</a></li><li id="menu-item-92" class="menu-item menu-item-type-custom menu-item-92"><a href="https://foundation.gnome.org">The GNOME Foundation</a></li><li><a href="https://www.gnome.org/support-gnome/">Support GNOME</a></li><li><a href="https://www.gnome.org/contact/">Contact</a></li></ul></li></ul></div><div class="menu-footer-2-container"><ul id="menu-footer-2" class="menu"><li id="menu-item-99" class="menu-item menu-item-type-post_type current-menu-item page_item page-item-20 current_page_item menu-item-99"><a href="index.html#">Resources</a><ul class="sub-menu"><li><a href="https://help.gnome.org">Documentation</a></li><li><a href="https://wiki.gnome.org">Wiki</a></li><li><a href="https://mail.gnome.org/mailman/listinfo">Mailing Lists</a></li><li><a href="https://wiki.gnome.org/GnomeIrcChannels">IRC Channels</a></li><li><a href="https://gitlab.gnome.org/">Bug Tracker</a></li><li><a href="https://gitlab.gnome.org/">Development Code</a></li><li><a href="https://wiki.gnome.org/Jhbuild">Build Tool</a></li></ul></li></ul></div><div class="menu-footer-4-container"><ul id="menu-footer-4" class="menu"><li id="menu-item-104" class="menu-item menu-item-type-custom menu-item-104"><a href="http://www.gnome.org/news/">News</a><ul class="sub-menu"><li><a href="https://www.gnome.org/start/stable">Latest Release</a></li><li><a href="https://planet.gnome.org">Planet GNOME</a></li><li><a href="https://news.gnome.org">Development News</a></li><li><a href="https://twitter.com/gnome">Twitter</a></li></ul></li></ul></div></div><div class="links grid_3 right"><div><ul class="menu available_languages"><li><strong>This website is available in many languages</strong><ul class="sub-menu"><li><a href="../languages.html" title="Switching Language">Switch Language</a></li></ul></li></ul><script type="text/javascript" src="../js/language.js"></script></div></div><div id="footnotes" class="grid_9">
                Copyright © 2005‒2014 <strong class="gnome_logo">The GNOME Project</strong><br></br><small>Optimised for standards. Hosted by <a href="http://redhat.com">Red Hat</a>.</small></div><div class="clear"></div></div></div><script type="text/javascript">
$(document).ready(function() {
    // Get browser
    $.each($.browser, function(i) {
        $('body').addClass(i);
        return false;
    });

    // Get OS and add it as class to body tag, this then allows forcing some
    // customisation in the CSS rules.
    var match = navigator.userAgent.toLowerCase().match(/(win|mac|linux)/);
    if (match) {
        $('body').addClass(match[0]);
    }
});
</script><script type="text/javascript">
      var _paq = _paq || [];
      _paq.push(['disableCookies']);
      _paq.push(["trackPageView"]);
      _paq.push(["enableLinkTracking"]);

      (function() {
        var u=(("https:" == document.location.protocol) ? "https" : "http") + "://webstats.gnome.org/";
        _paq.push(["setTrackerUrl", u+"piwik.php"]);
        _paq.push(["setSiteId", "6"]);
        var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";
        g.defer=true; g.async=true; g.src=u+"piwik.js"; s.parentNode.insertBefore(g,s);
      })();
    </script></body></html>
