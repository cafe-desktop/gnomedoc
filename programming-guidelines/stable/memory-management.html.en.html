<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns:set="http://exslt.org/sets" xmlns:str="http://exslt.org/strings" xmlns:mal="http://projectmallard.org/1.0/">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Memory Management</title>
<link rel="stylesheet" type="text/css" media="all" href="https://static.gnome.org/css/grass-theme-style.css">
<link rel="stylesheet" type="text/css" media="all" href="../../skin/lgo2010.css">
<link rel="icon" type="image/png" href="../../skin/gnome-16.png">
<link rel="SHORTCUT ICON" type="image/png" href="../../skin/gnome-16.png">
<link rel="search" type="application/opensearchdescription+xml" href="../../gnome-library-search.xml" title="GNOME Library Search">
<link rel="stylesheet" type="text/css" href="../../skin/jquery.autocomplete.css">
<script type="text/javascript" src="../../js/jquery.js"></script><script type="text/javascript" src="../../js/jquery.autocomplete.js"></script><style type="text/css">
html { height: 100%; }
body {
  font-family: sans-serif;
  margin: 0; padding: 0;
  background-color: #ffffff;
  color: #000000;
  direction: ltr;
}
div.page {
  margin: 1em auto 1em auto;
  max-width: 60em;
  border: solid 1px #babdb6;
}
div.body {
  margin: 0;
  padding-left: 1em;
  padding-right: 1em;
  padding-bottom: 1em;
  min-height: 20em;
  background-color: #ffffff;
}
div.header { margin: 0; }
div.footer { margin: 0; }
div.sect {
  margin-top: 2.4em;
  clear: both;
}
div.sect div.sect {
  margin-top: 1.44em;
  margin-left: 1.72em;
}
div.trails {
  margin: 0;
  padding: 0.5em 1em 0.5em 1em;
  background-color: #f3f3f0;
}
div.trail {
  margin: 0.2em 0 0 0;
  padding: 0 1em 0 1em;
  text-indent: -1em;
  color: #2e3436;
}
a.trail { white-space: nowrap; }
div.hgroup {
  margin: 1em 0 0.5em 0;
  color: #2e3436;
}
div.sect div.hgroup {
  margin-top: 0;
  border-bottom: solid 1px #babdb6;
}
div.sect-links div.hgroup {
  border-bottom: solid 2px #729fcf;
}
div.sect div.sect-links {
  margin-left: 0;
}
div.sect div.sect-links div.hgroup {
  border: none;
}
h1, h2, h3, h4, h5, h6, h7 {
  margin: 0; padding: 0;
  color: #2e3436;
  font-weight: bold;
}
h1 { font-size: 2em; }
h2 { font-size: 1.44em; }
h3.title, h4.title, h5.title, h6.title, h7.title { font-size: 1.2em; }
h3, h4, h5, h6, h7 { font-size: 1em; }

p { line-height: 1.72em; }
div, pre, p { margin: 1em 0 0 0; padding: 0; }
div.contents > *:first-child,
th > *:first-child, td > *:first-child,
dt > *:first-child, dd > *:first-child,
li > *:first-child { margin-top: 0; }
div.inner, div.region, div.contents, pre.contents { margin-top: 0; }
pre.contents div { margin-top: 0 !important; }
p img { vertical-align: middle; }
p.lead { font-size: 1.2em; }
div.clear {
  margin: 0; padding: 0;
  height: 0; line-height: 0;
  clear: both;
}
.center { text-align: center; }

div.about {
  color: #2e3436;
}
div.about > div.inner > div.hgroup {
  margin: 0; padding: 0;
  text-align: center;
  border: none;
}
div.about > div.inner > div.hgroup > h2 {
  margin: 0; padding: 0.2em;
  font-size: inherit;
}
div.about.ui-expander > div.inner > div.hgroup span.title:before {
  content: "";
}
div.copyrights {
  margin: 1em;
  text-align: center;
}
div.copyright {
  margin: 0;
}
div.aboutblurb {
  display: inline-block;
  vertical-align: top;
  text-align: left;
  max-width: 18em;
  margin: 0 1em 1em 1em;
}
ul.credits, ul.credits li {
  margin: 0; padding: 0;
  list-style-type: none;
}
ul.credits li {
  margin-left: 1em;
  text-indent: -1em;
}

table {
  border-collapse: collapse;
  border-color: #2e3436;
  border-width: 1px;
}
td, th {
  padding: 0.5em;
  vertical-align: top;
  border-color: #2e3436;
  border-width: 1px;
}
thead td, thead th, tfoot td, tfoot th {
  font-weight: bold;
  color: #2e3436;
  background-color: #e5e5e3;
}
th {
  text-align: left;
  font-weight: bold;
  color: #2e3436;
}

ul, ol, dl { margin: 0; padding: 0; }
li {
  margin: 1em 0 0 0;
  margin-left: 2.4em;
  padding: 0;
}
li:first-child { margin-top: 0; }
dt { margin-top: 1em; }
dt:first-child { margin-top: 0; }
dt + dt { margin-top: 0; }
dd {
  margin: 0.2em 0 0 0;
  margin-left: 1.44em;
}
dd + dd { margin-top: 1em; }
ol.compact li { margin-top: 0.2em; }
ul.compact li { margin-top: 0.2em; }
ol.compact li:first-child { margin-top: 0; }
ul.compact li:first-child { margin-top: 0; }
dl.compact dt { margin-top: 0.2em; }
dl.compact dt:first-child { margin-top: 0; }
dl.compact dt + dt { margin-top: 0; }

a {
  text-decoration: none;
  color: #204a87;
}
a:visited { color: #5c3566; }
a:hover {
  border-bottom: dotted 1px #729fcf;
}
p a {
  border-bottom: dotted 1px #729fcf;
}
a img { border: none; }
@media only screen and (max-width: 400px) {
  div.page {
    margin: 0;
    border: none;
  }
  div.body {
    padding-left: 0;
    padding-right: 0;
  }
  div.body > div.hgroup,
  div.body > div.region > div.contents > *,
  div.body > div.region > div.sect > div.inner > div.hgroup > *,
  div.body > div.region > div.sect > div.inner > div.region > div.contents > * {
    margin-left: 12px;
    margin-right: 12px;
  }
  div.body > div.region > div.sect-links {
    margin-left: 0;
    margin-right: 0;
  }
  div.trails {
    padding: 12px;
  }
  li {
    margin-left: 1.44em;
  }
}

div.title {
  margin: 0 0 0.2em 0;
  font-weight: bold;
  color: #2e3436;
}
div.title h1, div.title h2, div.title h3, div.title h4, div.title h5, div.title h6 {
  margin: 0;
  font-size: inherit;
  font-weight: inherit;
  color: inherit;
}
div.desc { margin: 0 0 0.2em 0; }
div.contents + div.desc { margin: 0.2em 0 0 0; }
pre.contents {
  padding: 0.5em 1em 0.5em 1em;
}
div.links-center { text-align: center; }
div.links .desc { color: #2e3436; }
div.links > div.inner > div.region > div.desc { font-style: italic; }
div.links ul { margin: 0; padding: 0; }
div.links ul ul {
  margin-left: 1em;
}
li.links {
  margin: 0.5em 0 0.5em 0;
  padding: 0;
  padding-left: 1em;
  list-style-type: none;
}
div.sectionlinks {
  display: inline-block;
  padding: 0 1em 0 1em;
  background-color: #e6f2ff;
  border: solid 1px #729fcf;
}
div.sectionlinks ul { margin: 0; }
div.sectionlinks li { padding: 0; }
div.sectionlinks div.title { margin: 0.5em 0 0.5em 0; }
div.sectionlinks div.sectionlinks {
  display: block;
  margin: 0.5em 0 0 0;
  padding: 0;
  border: none;
}
div.sectionlinks div.sectionlinks li {
  padding-left: 1.44em;
}
div.nextlinks {
  font-size: 1.2em;
  margin-left: 1.2em;
  float: right;
  clear: both;
}
div.nextlinks a {
  background-color: #f3f3f0;
  display: inline-block;
  position: relative;
  height: 1.44em;
  padding: 0.2em 0.83em;
  margin-bottom: 1em;
}
a.nextlinks-prev { margin-left: 0.72em; }
a.nextlinks-next { margin-right: 0.72em; }
a.nextlinks-prev:after, a.nextlinks-next:after {
  border: solid transparent;
  content: " ";
  position: absolute;
  height: 0; width: 0;
  border-width: 0.92em;
  top: 50%;
  margin-top: -0.92em;
}
a.nextlinks-prev:after {
  right: 100%;
  border-right-color: #f3f3f0;
}
a.nextlinks-next:after {
  left: 100%;
  border-left-color: #f3f3f0;
}
div.nextlinks a:hover {
border: none;
  background: #e6f2ff
}
a.nextlinks-prev:hover:after {
  border-right-color: #e6f2ff
}
a.nextlinks-next:hover:after {
  border-left-color: #e6f2ff
}
div.serieslinks {
  display: inline-block;
  padding: 0 1em 0 1em;
  background-color: #e6f2ff;
  border: solid 1px #729fcf;
}
div.serieslinks ul { margin: 0; }
div.serieslinks li { padding: 0; }
div.serieslinks div.title { margin: 0.5em 0 0.5em 0; }
pre.numbered {
  margin: 0;
  padding: 0.5em;
  float: left;
  margin-right: 0.5em;
  text-align: right;
  color: #2e3436;
  background-color: #fffacc;
}
div.code {
  border: solid 1px #babdb6;
}
div.example {
  border-left: solid 4px #babdb6;
  padding-left: 1em;
}
div.figure {
  margin-left: 1.72em;
  padding: 4px;
  color: #2e3436;
  border: solid 1px #babdb6;
  background-color: #f3f3f0;
}
div.figure > div.inner > a.zoom {
  float: right;
}
div.figure > div.inner > div.region > div.contents {
  margin: 0;
  padding: 0.5em 1em 0.5em 1em;
  clear: both;
  text-align: center;
  color: #000000;
  border: solid 1px #babdb6;
  background-color: #ffffff;
}
div.list > div.inner > div.title { margin-bottom: 0.5em; }
div.listing > div.inner { margin: 0; padding: 0; }
div.listing > div.inner > div.region > div.desc { font-style: italic; }
div.note {
  padding: 6px;
  border: solid 1px #e5e5e3;
  background-color: #f3f3f0;
}
div.note > div.inner > div.title {
  margin-left: 30px;
}
div.note > div.inner > div.region > div.contents {
  margin: 0; padding: 0;
  margin-left: 30px;
}
div.note > div.inner {
  margin: 0; padding: 0;
  background-image: url("https://developer-old.gnome.org/programming-guidelines/stable/yelp-note.png");
  background-position: left top;
  background-repeat: no-repeat;
  min-height: 24px;
}
div.note-advanced > div.inner {  }
div.note-bug > div.inner { background-image: url("https://developer-old.gnome.org/programming-guidelines/stable/yelp-note-bug.png"); }
div.note-important > div.inner { background-image: url("https://developer-old.gnome.org/programming-guidelines/stable/yelp-note-important.png"); }
div.note-tip > div.inner { background-image: url("https://developer-old.gnome.org/programming-guidelines/stable/yelp-note-tip.png"); }
div.note-warning > div.inner { background-image: url("https://developer-old.gnome.org/programming-guidelines/stable/yelp-note-warning.png"); }
div.note-sidebar {
  float: right;
  max-width: 40%;
  margin-left: 6px;
  padding: 6px;
}
div.note-sidebar > div.inner { background-image: none; }
div.note-sidebar > div.inner > div.title { margin-left: 0px; }
div.note-sidebar > div.inner > div.region > div.contents { margin-left: 0px; }
div.note-plain > div.inner { background-image: none; }
div.note-plain > div.inner > div.title { margin-left: 0px; }
div.note-plain > div.inner > div.region > div.contents { margin-left: 0px; }
div.quote {
  padding: 0;
  min-height: 48px;
}
div.quote > div.inner:before {
  float: left;
  content: '“';
  font-family: "Century Schoolbook L";
  font-size: 48px;
  font-weight: bold;
  line-height: 1em;
  margin: 0; padding: 0;
  height: 48px;
  width: 48px;
  text-align: center;
  color: #e5e5e3;
}
div.quote > div.inner > div.title {
  margin: 0;
  margin-left: 48px;
}
blockquote {
  margin: 0; padding: 0;
  margin-left: 48px;
}
blockquote > *:first-child { margin-top: 0; }
div.quote > div.inner > div.region > div.cite {
  margin-top: 0.5em;
  margin-left: 48px;
  color: #2e3436;
}
div.quote > div.inner > div.region > div.cite::before {
  
  content: '― ';
  color: #2e3436;
}
div.screen {
  background-color: #f3f3f0;
  border: solid 1px #babdb6;
}
ol.steps, ul.steps {
  margin: 0;
  padding: 0.5em 1em 0.5em 1em;
  border-left: solid 4px #edd400;
  -moz-box-shadow: 0 1px 2px #babdb6;
  -webkit-box-shadow: 0 1px 2px #babdb6;
  box-shadow: 0 1px 2px #babdb6;
}
ol.steps .steps {
  padding: 0;
  border: none;
  background-color: none;
  -moz-box-shadow: none;
  -webkit-box-shadow: none;
  box-shadow: none;
}
li.steps { margin-left: 1.44em; }
li.steps li.steps { margin-left: 2.4em; }
div.synopsis > div.inner > div.region > div.contents,
div.synopsis > div.contents, div.synopsis > pre.contents {
  padding: 0.5em 1em 0.5em 1em;
  border-top: solid 1px;
  border-bottom: solid 1px;
  border-color: #729fcf;
  background-color: #f3f3f0;
}
div.synopsis > div.inner > div.region > div.desc { font-style: italic; }
div.synopsis div.code {
  background: none;
  border: none;
  padding: 0;
}
div.synopsis div.code > pre.contents { margin: 0; padding: 0; }
div.table > div.desc { font-style: italic; }
tr.shade {
  background-color: #f3f3f0;
}
td.shade {
  background-color: #f3f3f0;
}
tr.shade td.shade {
  background-color: #e5e5e3;
}

span.app { font-style: italic; }
span.cmd {
  font-family: monospace;
  background-color: #f3f3f0;
  padding: 0 0.2em 0 0.2em;
}
span.cmd span.cmd { background-color: none; padding: 0; }
pre span.cmd { background-color: none; padding: 0; }
span.code {
  font-family: monospace;
  border-bottom: solid 1px #e5e5e3;
}
span.code span.code { border: none; }
pre span.code { border: none; }
span.em { font-style: italic; }
span.em-bold {
  font-style: normal; font-weight: bold;
  color: #2e3436;
}
pre span.error {
  color: #a40000;
}
span.file { font-family: monospace; }
span.gui, span.guiseq { color: #2e3436; }
span.input { font-family: monospace; }
pre span.input {
  font-weight: bold;
  color: #2e3436;
}
kbd {
  font-family: inherit;
  font-size: inherit;
  color: #2e3436;
  background-color: #f3f3f0;
  border: solid 1px #babdb6;
  -moz-border-radius: 2px;
  -webkit-border-radius: 2px;
  border-radius: 2px;
  -moz-box-shadow: 1px 1px 2px #babdb6;
  -webkit-box-shadow: 1px 1px 2px #babdb6;
  box-shadow: 1px 1px 2px #babdb6;
  margin: 0 0.2em 0 0.2em;
  padding: 0 0.5em 0 0.5em;
  white-space: nowrap;
}
kbd.key-Fn {
  font-weight: bold;
  color: #729fcf;
}
span.key a {
  border-bottom: none;
}
a > kbd {
  color: #204a87;
  border-color: #729fcf;
}
span.keyseq {
  color: #2e3436;
  white-space: nowrap
}
span.output { font-family: monospace; }
pre span.output {
  color: #000000;
}
pre span.prompt {
  color: #2e3436;
}
span.sys { font-family: monospace; }
span.var { font-style: italic; }

.ui-tile-img .media-controls { display: none; }
span.media-audio, span.media-video { display: inline-block; }
audio, video { display: block; margin: 0; }
div.media > div.inner { display: inline-block; text-align: center; }
div.media-controls {
  min-width: 24em;
  height: 24px;
  margin: 0; padding: 0;
  border-left: solid 1px #000000;;
  border-right: solid 1px #000000;;
  border-bottom: solid 1px #000000;;
  background-color: #2e3436;
  color: #ffffff;
  -moz-border-bottom-left-radius: 4px;
  -moz-border-bottom-right-radius: 4px;
  -webkit-border-bottom-left-radius: 4px;
  -webkit-border-bottom-right-radius: 4px;
  border-bottom-left-radius: 4px;
  border-bottom-right-radius: 4px;
}
div.media-controls-audio {
  border-top: solid 1px #000000;;
  -moz-border-radius: 4px;
  -webkit-border-radius: 4px;
  border-radius: 4px;
}
button.media-play {
  height: 24px;
  padding: 0 2px 0 2px; line-height: 0;
  float: left;
  background-color: #2e3436;
  border: none;
  border-right: solid 1px #000000;;
}
button.media-play:hover, button.media-play:focus {
  background-color: #729fcf;
}
button.media-play canvas { margin: 0; }
div.media-range {
  display: inline-block;
  margin: 2px 8px 0 8px;
  padding: 0;
  height: 20px;
}
div.media-time {
  float: right;
  margin: 0;
  font-size: 16px;
  height: 24px;
  line-height: 24px;
}
div.media-time > span {
  padding-right: 8px;
}
span.media-duration {
  font-size: 12px;
  color: #e5e5e3;
  opacity: 0.8;
}
div.media-ttml { margin: 0; padding: 0; }
.media-ttml-pre { white-space: pre; }
.media-ttml-nopre { white-space: normal; }
div.media-ttml-div {
  text-align: left;
  display: none;
  margin: 0; padding: 0;
}
div.media-ttml-p {
  text-align: left;
  display: none;
  margin: 6px auto 0 auto;
  padding: 6px;
  max-width: 24em;
  border: solid 1px #edd400;
  background-color: #fffacc;
  -moz-box-shadow: 2px 2px 4px #babdb6;
  -webkit-box-shadow: 2px 2px 4px #babdb6;
  box-shadow: 2px 2px 4px #babdb6;
}
div.yelp-data { display: none; }
div.ui-expander > div.inner > div.title span.title,
div.ui-expander > div.inner > div.hgroup span.title {
  cursor: default;
}
div.ui-expander > div.inner > div.title span.title:before,
div.ui-expander > div.inner > div.hgroup span.title:before {
  font-size: 2em;
  font-weight: normal;
  content: "⌃";
  display: inline-block;
  line-height: 0.2em;
  vertical-align: bottom;
  color: #204a87;
}
div.ui-expander-c > div.inner > div.hgroup { border-bottom: none; }
div.ui-expander-e > div.inner > div.title span.title:before,
div.ui-expander-e > div.inner > div.hgroup span.title:before {
  content: "⌄";
  vertical-align: top;
}
div.ui-expander > div.inner > div.title:hover,
div.ui-expander > div.inner > div.hgroup:hover * {
  color: #204a87;
}
div.ui-expander > div.inner > div.hgroup > .subtitle {
  margin-left: 2em;
}
@media only screen and (max-width: 400px) {
  div.links {
    margin-left: 12px;
    margin-right: 12px;
  } 
  li.links { padding: 0; }
  div.body > div.region > div.contents > div.example,
  div.body > div.region > div.contents > div.steps,
  div.body > div.region > div.contents > div.note,
  div.body > div.region > div.sect > div.inner > div.region > div.contents > div.example,
  div.body > div.region > div.sect > div.inner > div.region > div.contents > div.steps,
  div.body > div.region > div.sect > div.inner > div.region > div.contents > div.note {
    margin-left: 0;
    margin-right: 0;
  }
  div.steps > div.inner > div.title {
    margin-left: 18px;
    margin-right: 18px;
  }
  ol.steps, ul.steps {
    -moz-box-shadow: none;
    -webkit-box-shadow: none;
    box-shadow: none;
  }
  div.note-sidebar {
    float: none;
    max-width: none;
    margin-left: inherit;
    margin-right: inherit;
    padding-left: inherit;
    padding-right: inherit;
  }
  div.note-sidebar > div.inner > div.title,
  div.note-sidebar > div.inner > div.region > div.contents {
    margin-left: 12px;
    margin-right: 12px;
  }
}

div.link-button {
  font-size: 1.2em;
  font-weight: bold;
}
.link-button a {
  display: inline-block;
  background-color: #729fcf;
  color: #ffffff;
  text-shadow: #204a87 1px 1px 0px;
  border: solid 1px #204a87;
  padding: 0.2em 0.5em 0.2em 0.5em;
  -moz-border-radius: 2px;
  -webkit-border-radius: 2px;
  border-radius: 2px;
}
.link-button a:visited {
  color: #ffffff;
}
.link-button a:hover {
  text-decoration: none;
  color: #ffffff;
  box-shadow: 1px 1px 1px #729fcf;
}
div.link-button a .desc {
  display: block;
  font-weight: normal;
  font-size: 0.83em;
  color: #f3f3f0;
}
div.floatleft {
  float: left;
  margin-right: 1em;
}
div.floatright {
  float: right;
  margin-left: 1em;
}
div.floatstart {
  float: left;
  margin-right: 1em;
}
div.floatend {
  float: right;
  margin-left: 1em;
}

div.title-heading h1, div.title-heading h2, div.title-heading h3,
div.title-heading h4, div.title-heading h5, div.title-heading h6 {
  font-size: 1.72em;
  font-weight: bold;
}
ul.links-heading > li { margin: 2em 0 2em 0; padding: 0; }
div.links-heading > a { font-size: 1.72em; font-weight: bold; }
ul.links-heading > li > div.desc { margin-top: 0.5em; }

div.mouseovers {
  width: 250px;
  height: 200px;
  text-align: center;
  margin: 0;
  float: left;
}
ul.mouseovers li { margin: 0; }
ul.mouseovers a {
  display: inline-block;
  padding: 4px 1.2em 4px 1.2em;
  border-bottom: none;
}
ul.mouseovers a:hover {
  text-decoration: none;
  background: #e6f2ff;
}
ul.mouseovers a img {
  display: none;
  position: absolute;
  margin: 0; padding: 0;
}
@media only screen and (max-width: 400px) {
  ul.mouseovers a {
    display: block;
    padding: 12px;
    margin-left: -12px;
    margin-right: -12px;
  }
  div.mouseovers { display: none; }
}

div.ui-screen {
  display: none;
  position: fixed;
  margin: 0;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background: #2e3436;
  opacity: 0.6;
}
div.ui-overlay {
  display: none;
  position: fixed;
  text-align: center;
  left: 0;
  top: 20px;
  width: 100%;
  z-index: 10;
}
div.ui-overlay > div.inner {
  display: inline-block;
  padding: 8px;
  background-color: #f3f3f0;
  border: solid 1px #2e3436;
  box-shadow: 0 2px 4px #2e3436;
  -moz-border-radius: 6px;
  -webkit-border-radius: 6px;
  border-radius: 6px;
  text-align: left;
}
div.ui-overlay > div.inner > div.title { margin-top: -4px; }
a.ui-overlay-close {
  display: block;
  float: right;
  width: 23px; height: 23px;
  font-size: 18px; line-height: 23px;
  font-weight: bold;
  margin-top: -28px;
  margin-right: -24px;
  padding: 1px 2px 3px 2px;
  text-align: center;
  border: none;
  -moz-border-radius: 50%;
  -webkit-border-radius: 50%;
  border-radius: 50%;
  background-color: #000000;
  background-image: -moz-radial-gradient(50% 30%, circle farthest-corner, #2e3436, #000000);
  background-image: radial-gradient(50% 30%, circle farthest-corner, #2e3436, #000000);
  background-image: -webkit-radial-gradient(50% 30%, circle farthest-corner, #2e3436, #000000);
  border: 3px solid #ffffff; 
  color: #ffffff;
  box-shadow: 0 2px 2px #000000;
  text-shadow: 0 2px 2px #000000;
}
a.ui-overlay-close:hover {
}

div.ui-tile {
  display: inline-block;
  vertical-align: top;
  clear: both
}
div.region > div.ui-tile {
  margin-top: 0;
  margin-bottom: 1em;
}
div.ui-tile:first-child { margin-top: 1em; }
div.ui-tile > a {
  display: inline-block;
  vertical-align: top;
  margin: 0;
  margin-right: 1em;
  padding: 1em;
  -moz-border-radius: 6px;
  -webkit-border-radius: 6px;
  border-radius: 6px;
}
div.ui-tile > a {
  border: solid 1px #f3f3f0;
}
div.ui-tile > a:hover {
  border: solid 1px #e6f2ff;
  box-shadow: 0 1px 2px #729fcf;
}
div.ui-tile > a > * { display: block; }
div.ui-tile-side > a > * {
  display: inline-block;
  vertical-align: top;
}
div.ui-tile-side > a > span.ui-tile-text {
  margin-left: 1em;
}
div.ui-tile > a > span.ui-tile-text > span.title {
  display: block;
  margin-top: 0.5em;
  font-weight: bold;
}
div.ui-tile-side > a > span.ui-tile-text > span.title { margin-top: 0; }
div.ui-tile > a > span.ui-tile-text > span.desc {
  display: block;
  margin: 0.2em 0 0 0;
  color: #2e3436;
}
span.ui-tile-img { text-align: center; }

div.links-ui-hover {
  text-align: center;
  margin: 0;
  float: left;
  margin-right: 1.2em;
  overflow: hidden;
}
ul.links-ui-hover li { margin: 0; }
ul.links-ui-hover a {
  display: block;
  padding: 4px 1.2em 4px 1.2em;
  border-bottom: none;
}
ul.links-ui-hover a:hover {
  text-decoration: none;
  background: #e6f2ff;
}
span.links-ui-hover-img {
  display: none;
  position: absolute;
  margin: 0; padding: 0;
  overflow: hidden;
  background: #e6f2ff;
  text-align: center;
}
@media only screen and (max-width: 400px) {
  ul.links-ui-hover a {
    display: block;
    padding: 12px;
    margin-left: -12px;
    margin-right: -12px;
  }
  div.links-ui-hover { display: none; }
}

div.links-grid {
  display: inline-block;
  clear: both
  margin-top: 1em;
  width: 30%;
  margin-right: 2%;
  vertical-align: top;
}
div.links-grid-link {
  margin: 0;
  font-weight: bold;
}
div.links-grid > div.desc {
  margin: 0;
  color: #2e3436;
}
@media only screen and (max-width: 400px) {
  div.links-grid {
    width: 47%;
  }
}

div.links-norwich {
  width: 900px;
}
div.links-norwich-primary {
  float: left;
  vertical-align: top;
  margin: 0; padding: 0;
}
div.links-norwich-big {
  vertical-align: top;
  display: inline-block;
  background: #e6f2ff;
  background: radial-gradient(ellipse 800px 1200px at 100% 20px, #e6f2ff, #729fcf);
  margin: 0 20px 20px 0;
}
div.links-norwich-big + div.links-norwich-big {
  background: #fffacc;
  background: radial-gradient(ellipse 800px 1200px at 100% 20px, #fffacc, #edd400);
}
div.links-norwich-big a {
  display: block;
  width: 230px;
  height: 500px;
  height: 320px;
  padding: 9px;
  font-size: 1.2em;
  color:  #000000;
  border: solid 1px #729fcf;
  background-repeat: no-repeat;
  background-position: right -80px bottom -80px;
}
div.links-norwich-big a:hover {
  border: solid 1px #729fcf;
  box-shadow: 2px 2px 2px #729fcf;
}
div.links-norwich-big a span.title {
  font-size: 1.2em;
  font-weight: bold;
}
div.links-norwich-big a .desc {
  color:  #000000;
  font-weight: normal;
}
div.links-norwich-secondary {
  vertical-align: top;
  margin: 0; padding: 0;
}
div.links-norwich-small {
  display: inline-block;
  vertical-align: top;
  background: #f3f3f0;
  margin: 0 20px 20px 0;
}
div.links-norwich-small a {
  display: block;
  width: 140px;
  height: 140px;
  padding: 9px;
  font-weight: bold;
  color:  #000000;
  border: solid 1px #babdb6;
  background-repeat: no-repeat;
  background-position: right 4px bottom 4px;
}
div.links-norwich-small a:hover {
  border: solid 1px #babdb6;
  box-shadow: 2px 2px 2px #729fcf;
}
@media only screen and (max-width: 900px) {
  div.links-norwich {
    width: 720px;
  }
}
@media only screen and (max-width: 720px) {
  div.links-norwich {
    width: 540px;
  }
}
@media only screen and (max-width: 540px) {
  div.links-norwich {
    width: 100%;
  }
  div.links-norwich-big {
    width: 100%;
    margin-right: 0;
  }
  div.links-norwich-big a {
    width: auto;
  }
}

div.links-twocolumn {
  display: inline-block;
  width: 48%;
  margin-top: 0;
  margin-right: 1%;
  vertical-align: top;
}
@media only screen and (max-width: 400px) {
  div.links-twocolumn {
    width: 100%;
    margin-right: 0;
  }
}

div.links .desc a {
  color: inherit;
}
div.links .desc a:hover {
  color: #204a87;
}
a.bold { font-weight: bold; }
div.linkdiv { margin: 0; padding: 0; }
a.linkdiv {
  display: block;
  margin: 0;
  padding: 0.5em;
  border-bottom: none;
}
a.linkdiv:hover {
  text-decoration: none;
  background-color: #e6f2ff;
}
a.linkdiv > span.title {
  display: block;
  margin: 0;
  font-size: 1em;
  font-weight: bold;
  color: inherit;
}
a.linkdiv > span.desc {
  display: block;
  margin: 0.2em 0 0 0;
  color: #2e3436;
}
span.linkdiv-dash { display: none; }
@media only screen and (max-width: 400px) {
  div.linkdiv {
    margin-left: -12px;
    margin-right: -12px;
  }
  div.linkdiv a {
    padding-left: 12px;
    padding-right: 12px;
  }
}

div.comment {
  padding: 0.5em;
  border: solid 2px #ef2929;
  background-color: #ffdede;
}
div.comment div.comment {
  margin: 1em 1em 0 1em;
}
div.comment div.cite {
  margin: 0 0 0.5em 0;
  font-style: italic;
}

div.tree > div.inner > div.title { margin-bottom: 0.5em; }
ul.tree {
  margin: 0; padding: 0;
  list-style-type: none;
}
li.tree { margin: -2px 0 0 0; padding: 0; }
li.tree div { margin: 0; padding: 0; }
ul.tree ul.tree {
  margin-left: 1.44em;
}
div.tree-lines ul.tree { margin-left: 0; }

span.hi {
  background-color: #fffacc;
}

div.facets {
  display: inline-block;
  padding: 6px;
  background-color: #fffacc;
  border: solid 1px #729fcf;
} 
div.facet {
 vertical-align: top;
  display: inline-block;
  margin-top: 0;
  margin-bottom: 1em;
  margin-right: 1em;
}
div.facet div.title { margin: 0; }
div.facet li {
  margin: 0; padding: 0;
  list-style-type: none;
}
div.facet input {
  vertical-align: middle;
  margin: 0;
}
dt.gloss-term {
  margin-top: 1.2em;
  font-weight: bold;
  color: #2e3436;
}
dt.gloss-term:first-child, dt.gloss-term + dt.gloss-term { margin-top: 0; }
dt.gloss-term + dd { margin-top: 0.2em; }
dd.gloss-link {
  margin: 0 0.2em 0 0.2em;
  border-left: solid 4px #729fcf;
  padding-left: 1em;
}
dd.gloss-def {
  margin: 0 0.2em 1em 0.2em;
  border-left: solid 4px #babdb6;
  padding-left: 1em;
}
a.gloss-term {
  tabindex: 0;
  border-bottom: dashed 1px #729fcf;
}
a.gloss-term:hover {
  text-decoration: none;
  border-bottom-style: solid;
}
span.gloss-desc {
  display: none;
  position: absolute;
  margin: 0;
  padding: 0.2em 0.5em 0.2em 0.5em;
  max-width: 24em;
  color: #2e3436;
  background-color: #fffacc;
  border: solid 1px #edd400;
  -moz-box-shadow: 2px 2px 4px #babdb6;
  -webkit-box-shadow: 2px 2px 4px #babdb6;
  box-shadow: 2px 2px 4px #babdb6;
}

.if-if { display: none; }
.if-choose, .if-when, .if-else { margin: 0; padding: 0; }
.if-choose > .if-when { display: none; }
.if-choose > .if-else { display: block; }
.if-if.if__not-target-mobile { display: block; }
.if-choose.if__not-target-mobile > .if-when { display: block; }
.if-choose.if__not-target-mobile > .if-else { display: none; }
@media only screen and (max-width: 400px) {
  .if-if.if__target-mobile { display: block; }
  .if-if.if__not-target-mobile { display: none; }
  .if-choose.if__target-mobile > .if-when { display: block; }
  .if-choose.if__target-mobile > .if-else { display: none; }
  .if-choose.if__not-target-mobile > .if-when { display: none; }
  .if-choose.if__not-target-mobile > .if-else { display: block; }
}
</style>
<script type="text/javascript" src="../../js/jquery.js"></script><link rel="stylesheet" type="text/css" href="../../skin/mallard.css">
<script type="text/javascript" language="javascript">
var __yelp_generate_id_counter__ = 0;
function yelp_generate_id () {
  var ret = 'yelp--' + (++__yelp_generate_id_counter__).toString();
  if ($('#' + ret).length != 0)
    return yelp_generate_id();
  else
    return ret;
};
$(document).ready (function () {
  var highlight_hash = function () {
    if (location.hash != '') {
      var sect = $(location.hash);
      sect.css('background-color',  '#fffacc');
      window.setTimeout(function () {
        sect.css({
          '-webkit-transition': 'background-color 2s linear',
          '-moz-transition': 'background-color 2s linear',
          'transition': 'background-color 2s linear',
          'background-color': 'rgba(1, 1, 1, 0)'
        });
      }, 200);
    }
  };
  $(window).bind('hashchange', highlight_hash);
  highlight_hash();
});

$.fn.yelp_ui_expander_toggle = function (onlyopen, callback) {
  var expander = $(this);
  var region = expander.children('.inner').children('.region');
  var yelpdata = expander.children('div.yelp-data-ui-expander');
  var compfunc = function () {
    if (expander.is('div.figure')) { expander.yelp_auto_resize(); }
    if (callback) { callback(); }
    return true;
  };
  var title = expander.children('.inner').children('.title');
  if (title.length == 0)
    title = expander.children('.inner').children('.hgroup');
  var title = title.find('span.title:first');
  if (expander.is('.ui-expander-e')) {
    if (!onlyopen) {
      expander.removeClass('ui-expander-e').addClass('ui-expander-c');
      region.attr('aria-expanded', 'false').slideUp('fast', compfunc);
      title.html(yelpdata.children('div.yelp-title-collapsed').html());
    }
  }
  else {
    expander.removeClass('ui-expander-c').addClass('ui-expander-e');
    region.attr('aria-expanded', 'true').slideDown('fast', compfunc);
    title.html(yelpdata.children('div.yelp-title-expanded').html());
  }
};
$(document).ready(function () {
  $('.ui-expander').each(function () {
    var expander = $(this);
    var yelpdata = expander.children('div.yelp-data-ui-expander');
    var region = expander.children('.inner').children('.region');
    var title = expander.children('.inner').children('.title');
    var issect = false;
    if (title.length == 0) {
      title = expander.children('.inner').children('.hgroup');
      issect = true;
    }
    if (title.length == 0) {
      return;
    }
    if (region.attr('id') == '')
      region.attr('id', yelp_generate_id());
    title.attr('aria-controls', region.attr('id'));
    var titlespan = title.find('span.title:first');
    var title_e = yelpdata.children('div.yelp-title-expanded');
    var title_c = yelpdata.children('div.yelp-title-collapsed');
    if (title_e.length == 0)
      yelpdata.append($('<div class="yelp-title-expanded"></div>').html(titlespan.html()));
    if (title_c.length == 0)
      yelpdata.append($('<div class="yelp-title-collapsed"></div>').html(titlespan.html()));
    if (yelpdata.attr('data-yelp-expanded') == 'false') {
      expander.addClass('ui-expander-c');
      region.attr('aria-expanded', 'false').hide();
      if (title_c.length != 0)
        titlespan.html(title_c.html());
    } else {
      expander.addClass('ui-expander-e');
      region.attr('aria-expanded', 'true');
      if (title_e.length != 0)
        titlespan.html(title_e.html());
    }
    title.click(function () {
      expander.yelp_ui_expander_toggle(false);
    });
  });
});
$(document).ready(function () {
  var expand_hash = function () {
    if (location.hash != '') {
      var target = $(location.hash);
      var parents = target.parents('div.ui-expander');
      if (target.is('div.ui-expander'))
        parents = parents.andSelf();
      parents.each(function () {
        $(this).yelp_ui_expander_toggle(true, function () {
          window.scrollTo(0, $(target).offset().top);
        });
      });
    }
  };
  $(window).bind('hashchange', expand_hash);
  expand_hash();
});

yelp_color_text_light = '#2e3436';
yelp_color_gray_background = '#f3f3f0';
yelp_color_gray_border = '#babdb6';
yelp_paint_zoom = function (zoom, zoomed) {
  var ctxt = zoom.children('canvas')[0].getContext('2d');
  ctxt.strokeStyle = ctxt.fillStyle = yelp_color_text_light;
  ctxt.clearRect(0, 0, 10, 10);
  ctxt.strokeRect(0.5, 0.5, 9, 9);
  if (zoomed) {
    ctxt.fillRect(1, 1, 9, 4);
    ctxt.fillRect(5, 5, 4, 4);
    zoom.attr('title', zoom.attr('data-zoom-out-title'));
  }
  else {
    ctxt.fillRect(1, 5, 4, 4);
    zoom.attr('title', zoom.attr('data-zoom-in-title'));
  }
}
$.fn.yelp_auto_resize = function () {
  var fig = $(this);
  if (fig.is('img'))
    fig = fig.parents('div.figure').eq(0);
  if (fig.data('yelp-zoom-timeout') != undefined) {
    clearInterval(fig.data('yelp-zoom-timeout'));
    fig.removeData('yelp-zoom-timeout');
  }
  var imgs = fig.find('img');
  for (var i = 0; i < imgs.length; i++) {
    var img = $(imgs[i]);
    if (img.data('yelp-load-bound') == true)
      img.unbind('load', fig.yelp_auto_resize);
    if (!imgs[i].complete) {
      img.data('yelp-load-bound', true);
      img.bind('load', fig.yelp_auto_resize);
      return false;
    }
  }
  $(window).unbind('resize', yelp_resize_imgs);
  var zoom = fig.children('div.inner').children('a.zoom');
  if (fig.find('div.contents:first').is(':hidden')) {
    zoom.hide();
    return;
  }
  for (var i = 0; i < imgs.length; i++) {
    var img = $(imgs[i]);
    if (img.data('yelp-original-width') == undefined) {
      var iwidth = parseInt(img.attr('width'));
      if (!iwidth)
        iwidth = img[0].width;
      img.data('yelp-original-width', iwidth);
      var iheight = parseInt(img.attr('height'));
      if (!iheight)
        iheight = img[0].height * (iwidth / img[0].width);
      img.data('yelp-original-height', iheight);
    }
    if (img.data('yelp-original-width') > img.parent().width()) {
      if (img.data('yelp-zoomed') != true) {
        img[0].width = img.parent().width();
        img[0].height = (parseInt(img.data('yelp-original-height')) *
                         img.width() / parseInt(img.data('yelp-original-width')));
      }
      zoom.show();
    }
    else {
      img[0].width = img.data('yelp-original-width');
      img[0].height = img.data('yelp-original-height');
      zoom.hide();
    }
  }
  /* The image scaling above can cause the window to resize if it causes
   * scrollbars to disappear or reapper. Unbind the resize handler before
   * scaling the image. Don't rebind immediately, because we'll still get
   * that resize event in an idle. Rebind on the callback instead.
   */
  var reresize = function () {
    $(window).unbind('resize', reresize);
    $(window).bind('resize', yelp_resize_imgs);
  }
  $(window).bind('resize', reresize);
  return false;
};
yelp_resize_imgs = function () {
  $('div.figure img').parents('div.figure').each(function () {
    var div = $(this);
    if (div.data('yelp-zoom-timeout') == undefined)
      div.data('yelp-zoom-timeout', setTimeout(function () { div.yelp_auto_resize() }, 1));
  });
  return false;
};
$(document).ready(function () {
  $('div.figure img').parents('div.figure').each(function () {
    var fig = $(this);
    var zoom = fig.children('div.inner').children('a.zoom');
    zoom.append($('<canvas width="10" height="10"/>'));
    yelp_paint_zoom(zoom, false);
    zoom.data('yelp-zoomed', false);
    zoom.click(function () {
      var zoomed = !zoom.data('yelp-zoomed');
      zoom.data('yelp-zoomed', zoomed);
      zoom.parent().find('img').each(function () {
        var zimg = $(this);
        zimg.data('yelp-zoomed', zoomed);
        if (zoomed) {
          zimg[0].width = zimg.data('yelp-original-width');
          zimg[0].height = zimg.data('yelp-original-height');
        } else {
          zimg[0].width = zimg.parent().width();
          zimg[0].height = (parseInt(zimg.data('yelp-original-height')) *
                            zimg.width() / parseInt(zimg.data('yelp-original-width')));
        }
        yelp_paint_zoom(zoom, zoomed);
      });
      return false;
    });
  });
  yelp_resize_imgs();
  $(window).bind('resize', yelp_resize_imgs);
});
function yelp_init_video (element) {
  var video = $(element);
  video.removeAttr('controls');

  var controls = $('<div class="media-controls media-controls-' + element.nodeName + '"></div>');
  var playControl = $('<button class="media-play"></button>').attr({
    'data-play-label': video.attr('data-play-label'),
    'data-pause-label': video.attr('data-pause-label'),
    'value': video.attr('data-play-label')
  });
  var playCanvas = $('<canvas width="20" height="20"></canvas>');
  playControl.append(playCanvas);
  var rangeCanvas = $('<canvas width="104" height="20"></canvas>');
  var rangeCanvasCtxt = rangeCanvas[0].getContext('2d');
  rangeCanvasCtxt.strokeStyle = yelp_color_gray_border;
  rangeCanvasCtxt.strokeWidth = 1;
  rangeCanvasCtxt.strokeRect(0.5, 0.5, 103, 19);
  var currentSpan = $('<span class="media-current">0:00</span>');
  var durationSpan = $('<span class="media-duration">-:--</span>');
  controls.append(playControl,
                  $('<div class="media-range"></div>').append(rangeCanvas),
                  $('<div class="media-time"></div>').append(currentSpan, durationSpan));
  video.after(controls);

  var playCanvasCtxt = playCanvas[0].getContext('2d');
  var paintPlayButton = function () {
    playCanvasCtxt.fillStyle = yelp_color_gray_background;
    playCanvasCtxt.clearRect(0, 0, 20, 20);
    playCanvasCtxt.beginPath();
    playCanvasCtxt.moveTo(5, 5);   playCanvasCtxt.lineTo(5, 15);
    playCanvasCtxt.lineTo(15, 10); playCanvasCtxt.lineTo(5, 5);
    playCanvasCtxt.fill();
  }
  var paintPauseButton = function () {
    playCanvasCtxt.fillStyle = yelp_color_gray_background;
    playCanvasCtxt.clearRect(0, 0, 20, 20);
    playCanvasCtxt.beginPath();
    playCanvasCtxt.moveTo(5, 5);   playCanvasCtxt.lineTo(9, 5);
    playCanvasCtxt.lineTo(9, 15);  playCanvasCtxt.lineTo(5, 15);
    playCanvasCtxt.lineTo(5, 5);   playCanvasCtxt.fill();
    playCanvasCtxt.beginPath();
    playCanvasCtxt.moveTo(11, 5);  playCanvasCtxt.lineTo(15, 5);
    playCanvasCtxt.lineTo(15, 15); playCanvasCtxt.lineTo(11, 15);
    playCanvasCtxt.lineTo(11, 5);  playCanvasCtxt.fill();
  }
  paintPlayButton();

  var video_el = video[0];
  var mediaChange = function () {
    if (video_el.ended)
      video_el.pause()
    if (video_el.paused) {
      playControl.attr('value', playControl.attr('data-play-label'));
      paintPlayButton();
    }
    else {
      playControl.attr('value', playControl.attr('data-pause-label'));
      paintPauseButton();
    }
  }
  video_el.addEventListener('play', mediaChange, false);
  video_el.addEventListener('pause', mediaChange, false);
  video_el.addEventListener('ended', mediaChange, false);

  var playClick = function () {
    if (video_el.paused || video_el.ended)
      video_el.play();
    else
      video_el.pause();
  };
  playControl.click(playClick);

  var ttmlDiv = video.parent().children('div.media-ttml');
  var ttmlNodes = ttmlDiv.find('.media-ttml-node');

  var timeUpdate = function () {
    var pct = (element.currentTime / element.duration) * 100;
    rangeCanvasCtxt.fillStyle = yelp_color_gray_border;
    rangeCanvasCtxt.clearRect(2, 2, 100, 16);
    rangeCanvasCtxt.fillRect(2, 2, pct, 16);
    var mins = parseInt(element.currentTime / 60);
    var secs = parseInt(element.currentTime - (60 * mins))
    currentSpan.text(mins + (secs < 10 ? ':0' : ':') + secs);
    ttmlNodes.each(function () {
      var ttml = this;
      if (element.currentTime >= parseFloat(ttml.getAttribute('data-ttml-begin')) &&
          (!ttml.hasAttribute('data-ttml-end') ||
           element.currentTime < parseFloat(ttml.getAttribute('data-ttml-end')) )) {
        if (ttml.tagName == 'span')
          ttml.style.display = 'inline';
        else
          ttml.style.display = 'block';
      }
      else {
        ttml.style.display = 'none';
      }
    });
  };
  element.addEventListener('timeupdate', timeUpdate, false);
  var durationUpdate = function () {
    if (!isNaN(element.duration)) {
      mins = parseInt(element.duration / 60);
      secs = parseInt(element.duration - (60 * mins));
      durationSpan.text(mins + (secs < 10 ? ':0' : ':') + secs);
    }
  };
  element.addEventListener('durationchange', durationUpdate, false);

  rangeCanvas.click(function (event) {
    var pct = event.clientX - Math.floor(rangeCanvas.offset().left);
    if (pct < 0)
      pct = 0;
    if (pct > 100)
      pct = 100;
    element.currentTime = (pct / 100.0) * element.duration;
  });
};
$(document).ready(function () {
  $('video, audio').each(function () { yelp_init_video(this) });;
});

$(document).ready(function () {
  $('input.facet').change(function () {
    var control = $(this);
    var content = control.closest('div.body,div.sect');
    content.find('.facet-link').each(function () {
      var link = $(this);
      var facets = link.parents('div.body,div.sect').children('div.region').children('div.contents').children('div.facets').children('div.facet');
      var visible = true;
      for (var i = 0; i < facets.length; i++) {
        var facet = facets.slice(i, i + 1);
        var facetvis = false;
        var inputs = facet.find('input.facet:checked');
        for (var j = 0; j < inputs.length; j++) {
          var input = inputs.slice(j, j + 1);
          var inputvis = false;
          var key = input.attr('data-facet-key');
          var values = input.attr('data-facet-values').split(' ');
          for (var k = 0; k < values.length; k++) {
            if (link.is('*[data-facet-' + key + ' ~= "' + values[k] + '"]')) {
              inputvis = true;
              break;
            }
          }
          if (inputvis) {
            facetvis = true;
            break;
          }
        }
        if (!facetvis) {
          visible = false;
          break;
        }
      }
      if (!visible)
        link.hide('fast');
      else
        link.show('fast');
    });
  });
});

$(document).ready(function () {
  $('a.gloss-term').each(function () {
    if ($(this).attr('href') == '#') {
      $(this).click(function () { return false; });
    }
    var showtip = function () {
      var desc = $(this).children('span.gloss-desc');
      if (desc.is(':visible'))
        return;
      var top = $(this).offset().top + $(this).height() + 1;
      var left = $(this).offset().left;
      var cnt = $(this).closest('div.contents');
      var diff = cnt.offset().left + cnt.width() - desc.width() - 4;
      if (left > diff)
        left = diff;
      desc.css({'top': top + 'px', 'left': left + 'px'}).fadeIn('slow');
    };
    var hidetip = function () {
      if ($(this).is(':focus'))
        return;
      $(this).children('span.gloss-desc').fadeOut('fast');
    };
    $(this).hover(showtip, hidetip);
    $(this).focus(showtip);
    $(this).blur(hidetip);
  });
});

$(document).ready(function () {
  $('div.mouseovers').each(function () {
    var contdiv = $(this);
    var width = 0;
    var height = 0;
    contdiv.find('img').each(function () {
      if ($(this).attr('data-yelp-match') == '')
        $(this).show();
    });
    contdiv.next('ul').find('a').each(function () {
      var mlink = $(this);
      mlink.hover(
        function () {
          if (contdiv.is(':visible')) {
            var offset = contdiv.offset();
            mlink.find('img').css({left: offset.left, top: offset.top, zIndex: 10});
            mlink.find('img').fadeIn('fast');
          }
        },
        function () {
          mlink.find('img').fadeOut('fast');
        }
      );
    });
  });
  $('div.links-ui-hover').each(function () {
    var contdiv = $(this);
    var width = 0;
    var height = 0;
    contdiv.next('ul').find('a').each(function () {
      var mlink = $(this);
      mlink.hover(
        function () {
          if (contdiv.is(':visible')) {
            var offset = contdiv.offset();
            mlink.find('img').parent('span').css({left: offset.left, top: offset.top, zIndex: 10});
            mlink.find('img').parent('span').show();
          }
        },
        function () {
          mlink.find('img').parent('span').hide();
        }
      );
    });
  });
  $('a.ui-overlay').each(function () {
    $(this).click(function () {
      var overlay = $(this).parent('div').children('div.ui-overlay');
      var inner = overlay.children('div.inner');
      var close = inner.children('a.ui-overlay-close');
      var media = inner.find('audio, video');
      var screen = $('div.ui-screen');
      if (screen.length == 0) {
        screen = $('<div class="ui-screen"></div>');
        $('body').append(screen);
      }
      var hideoverlay = function () {
        if (media.length > 0)
          media[0].pause();
        $(document).unbind('keydown.yelp-ui-overlay');
        close.unbind('click');
        screen.unbind('click');
        screen.fadeOut('slow');
        overlay.unbind('click');
        overlay.slideUp('fast');
        return false;
      };
      screen.click(hideoverlay);
      close.click(hideoverlay);
      $(document).bind('keydown.yelp-ui-overlay', function (event) {
        if (event.which == 27) {
          hideoverlay();
        }
      });
      overlay.click(function (event) {
        var target = event.target;
        do {
          if (target == inner[0]) {
            break;
          }
        } while (target = target.parentNode);
        if (target != inner[0]) {
          hideoverlay();
          return false;
        }
      });
      screen.fadeIn('slow');
      overlay.slideDown('fast', function () {
        if (media.length > 0)
          media[0].play();
      });
      return false;
    });
  });
});
</script><script type="text/javascript" language="javascript">
$(document).ready(function () {
  $('div.mouseovers').each(function () {
    var contdiv = $(this);
    var width = 0;
    var height = 0;
    var img = null;
    contdiv.find('img').each(function () {
      img = $(this);
      if ($(this).attr('data-yelp-match') == '')
        $(this).show();
    });
    contdiv.next('ul').find('a').each(function () {
      var mlink = $(this);
      console.log('mlink', $(this));
      mlink.hover(
        function () {
          var offset = img.offset();
          mlink.find('img').css({left: offset.left, top: offset.top, zIndex: 10});
          mlink.find('img').fadeIn('fast');
        },
        function () {
          mlink.find('img').fadeOut('fast');
        }
      );
    });
  })
});
       </script>
</head>
<body>
<div id="accessibility_access"><ul>
<li><a href="memory-management.html.en.html#container">Go to page content</a></li>
<li><a href="memory-management.html.en.html#top_bar">Go to main menu</a></li>
<li><a href="memory-management.html.en.html#s" onclick="$('#s').focus(); return false;">Go to the search field</a></li>
</ul></div>
<div id="global_domain_bar"><div class="maxwidth"><div class="tab"><a class="root" href="https://www.gnome.org/">GNOME.org</a></div></div></div>
<div id="header" class="container_12">
<div id="logo" class="grid_3"><a title="Go to home page" href="../../index.html"><img alt="GNOME: The Free Software Desktop Project" src="../../skin/gnome-logo-devcenter.png"></a></div>
<div id="top_bar" class="grid_9">
<div class="left"><div class="menu-globalnav-container"><ul id="menu-globalnav" class="menu">
<li class="menu-item menu-item-type-post_type menu-item-6"><a href="../../about/index.html">About</a></li>
<li class="menu-item menu-item-type-post_type menu-item-23"><a href="https://help.gnome.org/users/">Users</a></li>
<li class="menu-item menu-item-type-post_type menu-item-40"><a href="https://help.gnome.org/admin/">Administrators</a></li>
<li class="current-menu-item"><a href="https://developer.gnome.org/">Developers</a></li>
</ul></div></div>
<div class="right">
<form role="search" method="get" id="searchform" action="https://developer-old.gnome.org/symbols/"><div>
<label class="hidden" for="q">Search:
                        </label><input type="text" value="" name="q" id="s" placeholder="Search">
</div></form>
<script type="text/javascript">
$('#s').autocomplete('/symbols/lookup/',
        { minChars:3, matchSubset:1, matchContains:1, cacheLength:10,
          selectOnly:1, rowsLimit:25 });
              </script>
</div>
</div>
</div>
<div class="clearfix"></div>
<div id="container">
<div class="head"><div class="trails" role="navigation"><div class="trail">
<a class="trail" href="index.html.en.html" title="index">Programming Guidelines</a> › <a class="trail" href="index.html.en.html#general-guidelines" title="General Guidelines">General Guidelines</a> » </div></div></div>
<div class="content body"><div>
<div class="hgroup"><h1 class="title"><span class="title">Memory Management</span></h1></div>
<div class="region">
<div class="contents">
<p class="p">
    The GNOME stack is predominantly written in C, so dynamically allocated
    memory has to be managed manually. Through use of GLib convenience APIs,
    memory management can be trivial, but programmers always need to keep memory
    in mind when writing code.
  </p>
<p class="p">
    It is assumed that the reader is familiar with the idea of heap allocation
    of memory using <span class="code">malloc()</span> and <span class="code">free()</span>, and knows of
    the paired GLib equivalents, <span class="code">g_malloc()</span> and
    <span class="code">g_free()</span>.
  </p>
<div class="synopsis"><div class="inner">
<div class="title title-synopsis"><h2><span class="title">Summary</span></h2></div>
<div class="region"><div class="contents">
<p class="p">
      There are three situations to avoid, in order of descending importance:
    </p>
<div class="list"><div class="inner"><div class="region"><ol class="list" style="list-style-type:numbered">
<li class="list"><p class="p">Using memory after freeing it (use-after-free).</p></li>
<li class="list"><p class="p">Using memory before allocating it.</p></li>
<li class="list"><p class="p">Not freeing memory after allocating it (leaking).</p></li>
</ol></div></div></div>
<p class="p">
      Key principles, in no particular order:
    </p>
<div class="list"><div class="inner"><div class="region"><ul class="list">
<li class="list"><p class="p">
        Determine and document whether each variable is owned or unowned. They
        must never change from one to the other at runtime.
        (<span class="link"><a href="memory-management.html.en.html#principles" title="Principles of Memory Management">Principles of Memory Management</a></span>)
      </p></li>
<li class="list"><p class="p">
        Determine and document the ownership transfers at function boundaries.
        (<span class="link"><a href="memory-management.html.en.html#principles" title="Principles of Memory Management">Principles of Memory Management</a></span>)
      </p></li>
<li class="list"><p class="p">
        Ensure that each assignment, function call and function return respects
        the relevant ownership transfers. (<span class="link"><a href="memory-management.html.en.html#assignments" title="#assignments">#assignments</a></span>,
        <span class="link"><a href="memory-management.html.en.html#function-calls" title="#function-calls">#function-calls</a></span>, <span class="link"><a href="memory-management.html.en.html#function-returns" title="#function-returns">#function-returns</a></span>)
      </p></li>
<li class="list"><p class="p">
        Use reference counting rather than explicit finalization where possible.
        (<span class="link"><a href="memory-management.html.en.html#reference-counting" title="Reference Counting">Reference Counting</a></span>)
      </p></li>
<li class="list"><p class="p">
        Use GLib convenience functions like
        <span class="link"><a href="memory-management.html.en.html#g-clear-object" title="#g-clear-object"><span class="code">g_clear_object()</span></a></span> where
        possible. (<span class="link"><a href="memory-management.html.en.html#convenience-functions" title="Convenience Functions">Convenience Functions</a></span>)
      </p></li>
<li class="list"><p class="p">
        Do not split memory management across code paths.
        (<span class="link"><a href="memory-management.html.en.html#principles" title="Principles of Memory Management">Principles of Memory Management</a></span>)
      </p></li>
<li class="list"><p class="p">
        Use the single-path cleanup pattern for large or complex functions.
        (<span class="link"><a href="memory-management.html.en.html#single-path-cleanup" title="Single-Path Cleanup">Single-Path Cleanup</a></span>)
      </p></li>
<li class="list"><p class="p">
        Leaks should be checked for using Valgrind or the address sanitizer.
        (<span class="link"><a href="memory-management.html.en.html#verification" title="Verification">Verification</a></span>)
      </p></li>
</ul></div></div></div>
</div></div>
</div></div>
</div>
<div id="principles" class="sect"><div class="inner">
<div class="hgroup"><h2 class="title"><span class="title">Principles of Memory Management</span></h2></div>
<div class="region">
<div class="contents">
<p class="p">
      The normal approach to memory management is for the programmer to keep
      track of which variables point to allocated memory, and to manually free
      them when they are no longer needed. This is correct, but can be clarified
      by introducing the concept of <span class="em">ownership</span>, which is the piece of
      code (such as a function, struct or object) which is responsible for
      freeing a piece of allocated memory (an <span class="em">allocation</span>). Each
      allocation has exactly one owner; this owner may change as the program
      runs, by <span class="em">transferring</span> ownership to another piece of code. Each
      variable is <span class="em">owned</span> or <span class="em">unowned</span>, according to whether the
      scope containing it is always its owner. Each function parameter and
      return type either transfers ownership of the values passed to it, or it
      doesn’t. If code which owns some memory doesn’t deallocate that memory,
      that’s a memory leak. If code which doesn’t own some memory frees it,
      that’s a double-free. Both are bad.
    </p>
<p class="p">
      By statically calculating which variables are owned, memory
      management becomes a simple task of unconditionally freeing the owned
      variables before they leave their scope, and <span class="em">not</span> freeing the
      unowned variables (see <span class="link"><a href="memory-management.html.en.html#single-path-cleanup" title="Single-Path Cleanup">Single-Path Cleanup</a></span>). The key
      question to answer for all memory is: which code has ownership of this
      memory?
    </p>
<p class="p">
      There is an important restriction here: variables must
      <span class="em-bold em">never</span> change from owned to unowned (or vice-versa)
      at runtime. This restriction is key to simplifying memory management.
    </p>
<p class="p">
      For example, consider the functions:
    </p>
<div class="code"><pre class="contents ">gchar *generate_string (const gchar *template);
void print_string (const gchar *str);</pre></div>
<p class="p">
      The following code has been annotated to note where the ownership
      transfers happen:
    </p>
<div class="code"><pre class="contents ">gchar *my_str = NULL;  /* owned */
const gchar *template;  /* unowned */
GValue value = G_VALUE_INIT;  /* owned */
g_value_init (&amp;value, G_TYPE_STRING);

/* Transfers ownership of a string from the function to the variable. */
template = "XXXXXX";
my_str = generate_string (template);

/* No ownership transfer. */
print_string (my_str);

/* Transfer ownership. We no longer have to free @my_str. */
g_value_take_string (&amp;value, my_str);

/* We still have ownership of @value, so free it before it goes out of scope. */
g_value_unset (&amp;value);</pre></div>
<p class="p">
      There are a few points here: Firstly, the ‘owned’ comments by the variable
      declarations denote that those variables are owned by the local scope, and
      hence need to be freed before they go out of scope. The alternative is
      ‘unowned’, which means the local scope does <span class="em">not</span> have ownership,
      and <span class="em">must not</span> free the variables before going out of scope.
      Similarly, ownership <span class="em">must not</span> be transferred to them on
      assignment.
    </p>
<p class="p">
      Secondly, the variable type modifiers reflect whether they transfer
      ownership: because <span class="code">my_str</span> is owned by the local scope, it has
      type <span class="code">gchar</span>, whereas <span class="code">template</span> is
      <span class="code">const</span> to denote it is unowned. Similarly, the
      <span class="code">template</span> parameter of <span class="code">generate_string()</span> and the
      <span class="code">str</span> parameter of <span class="code">print_string()</span> are
      <span class="code">const</span> because no ownership is transferred when those
      functions are called. As ownership <span class="em">is</span> transferred for the string
      parameter of <span class="code">g_value_take_string()</span>, we can expect its type to
      be <span class="code">gchar</span>.
    </p>
<p class="p">
      (Note that this is not the case for
      <span class="link"><a href="https://developer.gnome.org/gobject/stable/gobject-The-Base-Object-Type.html" title="https://developer.gnome.org/gobject/stable/gobject-The-Base-Object-Type.html">
      <span class="code">GObject</span></a></span>s and subclasses, which can never be
      <span class="code">const</span>. It is only the case for strings and simple
      <span class="code">struct</span>s.)
    </p>
<p class="p">
      Finally, a few libraries use a function naming convention to indicate
      ownership transfer, for example using ‘take’ in a function name to
      indicate full transfer of parameters, as with
      <span class="code">g_value_take_string()</span>. Note that different libraries use
      different conventions, as shown below:
    </p>
<div class="table"><div class="inner"><div class="region"><table class="table">
<thead><tr>
<td><p class="p">Function name</p></td>
<td class="shade"><p class="p">Convention 1 (standard)</p></td>
<td><p class="p">Convention 2 (alternate)</p></td>
<td class="shade"><p class="p">Convention 3 (<span class="cmd">gdbus-codegen</span>)</p></td>
</tr></thead>
<tbody>
<tr class="shade">
<td><p class="p">get</p></td>
<td class="shade"><p class="p">No transfer</p></td>
<td><p class="p">Any transfer</p></td>
<td class="shade"><p class="p">Full transfer</p></td>
</tr>
<tr>
<td><p class="p">dup</p></td>
<td class="shade"><p class="p">Full transfer</p></td>
<td><p class="p">Unused</p></td>
<td class="shade"><p class="p">Unused</p></td>
</tr>
<tr class="shade">
<td><p class="p">peek</p></td>
<td class="shade"><p class="p">Unused</p></td>
<td><p class="p">Unused</p></td>
<td class="shade"><p class="p">No transfer</p></td>
</tr>
<tr>
<td><p class="p">set</p></td>
<td class="shade"><p class="p">No transfer</p></td>
<td><p class="p">No transfer</p></td>
<td class="shade"><p class="p">No transfer</p></td>
</tr>
<tr class="shade">
<td><p class="p">take</p></td>
<td class="shade"><p class="p">Full transfer</p></td>
<td><p class="p">Unused</p></td>
<td class="shade"><p class="p">Unused</p></td>
</tr>
<tr>
<td><p class="p">steal</p></td>
<td class="shade"><p class="p">Full transfer</p></td>
<td><p class="p">Full transfer</p></td>
<td class="shade"><p class="p">Full transfer</p></td>
</tr>
</tbody>
</table></div></div></div>
<p class="p">
      Ideally, all functions have a <span class="code">(transfer)</span>
      <span class="link"><a href="introspection.html.en.html" title="introspection">introspection annotation</a></span> for all
      relevant parameters and the return value. Failing that, here is a set of
      guidelines to use to determine whether ownership of a return value is
      transferred:
    </p>
<div class="steps"><div class="inner"><div class="region"><ol class="steps">
<li class="steps"><p class="p">
        If the type has an introspection <span class="code">(transfer)</span> annotation,
        look at that.
      </p></li>
<li class="steps"><p class="p">
        Otherwise, if the type is <span class="code">const</span>, there is no transfer.
      </p></li>
<li class="steps"><p class="p">
        Otherwise, if the function documentation explicitly specifies the return
        value must be freed, there is full or container transfer.
      </p></li>
<li class="steps"><p class="p">
        Otherwise, if the function is named ‘dup’, ‘take’ or ‘steal’, there is
        full or container transfer.
      </p></li>
<li class="steps"><p class="p">
        Otherwise, if the function is named ‘peek’, there is no transfer.
      </p></li>
<li class="steps"><p class="p">
        Otherwise, you need to look at the function’s code to determine whether
        it intends ownership to be transferred. Then file a bug against the
        documentation for that function, and ask for an introspection annotation
        to be added.
      </p></li>
</ol></div></div></div>
<p class="p">
      Given this ownership and transfer infrastructure, the correct approach to
      memory allocation can be mechanically determined for each situation. In
      each case, the <span class="code">copy()</span> function must be appropriate to the
      data type, for example <span class="code">g_strdup()</span> for strings, or
      <span class="code">g_object_ref()</span> for GObjects.
    </p>
<p class="p">
      When thinking about ownership transfer,
      <span class="code">malloc()</span>/<span class="code">free()</span> and reference counting are
      equivalent: in the former case, a newly allocated piece of heap memory is
      transferred; in the latter, a newly incremented reference.
      See <span class="link"><a href="memory-management.html.en.html#reference-counting" title="Reference Counting">Reference Counting</a></span>.
    </p>
</div>
<div id="assignments" class="sect"><div class="inner">
<div class="hgroup"><h3 class="title"><span class="title">Assignments</span></h3></div>
<div class="region"><div class="contents"><div class="table"><div class="inner"><div class="region"><table class="table">
<thead><tr>
<td><p class="p">Assignment from/to</p></td>
<td class="shade"><p class="p">Owned destination</p></td>
<td class="shade"><p class="p">Unowned destination</p></td>
</tr></thead>
<tbody>
<tr class="shade">
<td><p class="p">Owned source</p></td>
<td class="shade">
<p class="p">
                Copy or move the source to the destination.
              </p>
<div class="code"><pre class="contents ">owned_dest = copy (owned_src)</pre></div>
<div class="code"><pre class="contents ">owned_dest = owned_src; owned_src = NULL</pre></div>
</td>
<td class="shade">
<p class="p">
                Pure assignment, assuming the unowned variable is not used after
                the owned one is freed.
              </p>
<div class="code"><pre class="contents ">unowned_dest = owned_src</pre></div>
</td>
</tr>
<tr>
<td><p class="p">Unowned source</p></td>
<td class="shade">
<p class="p">Copy the source to the destination.</p>
<div class="code"><pre class="contents ">owned_dest = copy (unowned_src)</pre></div>
</td>
<td class="shade">
<p class="p">Pure assignment.</p>
<div class="code"><pre class="contents ">unowned_dest = unowned_src</pre></div>
</td>
</tr>
</tbody>
</table></div></div></div></div></div>
</div></div>
<div id="function-calls" class="sect"><div class="inner">
<div class="hgroup"><h3 class="title"><span class="title">Function Calls</span></h3></div>
<div class="region"><div class="contents"><div class="table"><div class="inner"><div class="region"><table class="table">
<thead><tr>
<td><p class="p">Call from/to</p></td>
<td class="shade"><p class="p">Transfer full parameter</p></td>
<td class="shade"><p class="p">Transfer none parameter</p></td>
</tr></thead>
<tbody>
<tr class="shade">
<td><p class="p">Owned source</p></td>
<td class="shade">
<p class="p">
                Copy or move the source for the parameter.
              </p>
<div class="code"><pre class="contents ">function_call (copy (owned_src))</pre></div>
<div class="code"><pre class="contents ">function_call (owned_src); owned_src = NULL</pre></div>
</td>
<td class="shade">
<p class="p">
                Pure parameter passing.
              </p>
<div class="code"><pre class="contents ">function_call (owned_src)</pre></div>
</td>
</tr>
<tr>
<td><p class="p">Unowned source</p></td>
<td class="shade">
<p class="p">Copy the source for the parameter.</p>
<div class="code"><pre class="contents ">function_call (copy (unowned_src))</pre></div>
</td>
<td class="shade">
<p class="p">Pure parameter passing.</p>
<div class="code"><pre class="contents ">function_call (unowned_src)</pre></div>
</td>
</tr>
</tbody>
</table></div></div></div></div></div>
</div></div>
<div id="function-returns" class="sect"><div class="inner">
<div class="hgroup"><h3 class="title"><span class="title">Function Returns</span></h3></div>
<div class="region"><div class="contents"><div class="table"><div class="inner"><div class="region"><table class="table">
<thead><tr>
<td><p class="p">Return from/to</p></td>
<td class="shade"><p class="p">Transfer full return</p></td>
<td class="shade"><p class="p">Transfer none return</p></td>
</tr></thead>
<tbody>
<tr class="shade">
<td><p class="p">Owned source</p></td>
<td class="shade">
<p class="p">
                Pure variable return.
              </p>
<div class="code"><pre class="contents ">return owned_src</pre></div>
</td>
<td class="shade"><p class="p">
                Invalid. The source needs to be freed, so the return value would
                use freed memory — a use-after-free error.
              </p></td>
</tr>
<tr>
<td><p class="p">Unowned source</p></td>
<td class="shade">
<p class="p">Copy the source for the return.</p>
<div class="code"><pre class="contents ">return copy (unowned_src)</pre></div>
</td>
<td class="shade">
<p class="p">Pure variable passing.</p>
<div class="code"><pre class="contents ">return unowned_src</pre></div>
</td>
</tr>
</tbody>
</table></div></div></div></div></div>
</div></div>
</div>
</div></div>
<div id="documentation" class="sect"><div class="inner">
<div class="hgroup"><h2 class="title"><span class="title">Documentation</span></h2></div>
<div class="region"><div class="contents">
<p class="p">
      Documenting the ownership transfer for each function parameter and return,
      and the ownership for each variable, is important. While they may be clear
      when writing the code, they are not clear a few months later; and may
      never be clear to users of an API. They should always be documented.
    </p>
<p class="p">
      The best way to document ownership transfer is to use the
      <span class="link"><a href="https://wiki.gnome.org/Projects/GObjectIntrospection/Annotations#Memory_and_lifecycle_management" title="https://wiki.gnome.org/Projects/GObjectIntrospection/Annotations#Memory_and_lifecycle_management">
      <span class="code">(transfer)</span></a></span> annotation introduced by
      <span class="link"><a href="introspection.html.en.html" title="introspection">gobject-introspection</a></span>. Include this in
      the API documentation comment for each function parameter and return type.
      If a function is not public API, write a documentation comment for it
      anyway and include the <span class="code">(transfer)</span> annotations. By doing so,
      the introspection tools can also read the annotations and use them to
      correctly introspect the API.
    </p>
<p class="p">
      For example:
    </p>
<div class="code"><pre class="contents ">/**
 * g_value_take_string:
 * @value: (transfer none): an initialized #GValue
 * @str: (transfer full): string to set it to
 *
 * Function documentation goes here.
 */

/**
 * generate_string:
 * @template: (transfer none): a template to follow when generating the string
 *
 * Function documentation goes here.
 *
 * Returns: (transfer full): a newly generated string
 */</pre></div>
<p class="p">
      Ownership for variables can be documented using inline comments. These are
      non-standard, and not read by any tools, but can form a convention if used
      consistently.
    </p>
<div class="code"><pre class="contents ">GObject *some_owned_object = NULL;  /* owned */
GObject *some_unowned_object;  /* unowned */</pre></div>
<p class="p">
      The documentation for <span class="link"><a href="memory-management.html.en.html#container-types" title="Container Types">Container Types</a></span> is similarly only a
      convention; it includes the type of the contained elements too:
    </p>
<div class="code"><pre class="contents ">GPtrArray/*&lt;owned gchar*&gt;*/ *some_unowned_string_array;  /* unowned */
GPtrArray/*&lt;owned gchar*&gt;*/ *some_owned_string_array = NULL;  /* owned */
GPtrArray/*&lt;unowned GObject*&gt;*/ *some_owned_object_array = NULL;  /* owned */</pre></div>
<p class="p">
      Note also that owned variables should always be initialized so that
      freeing them is more convenient. See
      <span class="link"><a href="memory-management.html.en.html#convenience-functions" title="Convenience Functions">Convenience Functions</a></span>.
    </p>
<p class="p">
      Also note that some types, for example basic C types like strings, can
      have the <span class="code">const</span> modifier added if they are unowned, to take
      advantage of compiler warnings resulting from assigning those variables to
      owned variables (which must <span class="em">not</span> use the <span class="code">const</span>
      modifier). If so, the <span class="code">/* unowned */</span> comment may be omitted.
    </p>
</div></div>
</div></div>
<div id="reference-counting" class="sect"><div class="inner">
<div class="hgroup"><h2 class="title"><span class="title">Reference Counting</span></h2></div>
<div class="region">
<div class="contents">
<p class="p">
      As well as conventional <span class="code">malloc()</span>/<span class="code">free()</span>-style
      types, GLib has various reference counted types —
      <span class="link"><a href="https://developer.gnome.org/gobject/stable/gobject-The-Base-Object-Type.html" title="https://developer.gnome.org/gobject/stable/gobject-The-Base-Object-Type.html">
      <span class="code">GObject</span></a></span> being a prime example.
    </p>
<p class="p">
      The concepts of ownership and transfer apply just as well to reference
      counted types as they do to allocated types. A scope <span class="em">owns</span> a
      reference counted type if it holds a strong reference to the instance
      (for example by calling
      <span class="link"><a href="https://developer.gnome.org/gobject/stable/gobject-The-Base-Object-Type.html#g-object-ref" title="https://developer.gnome.org/gobject/stable/gobject-The-Base-Object-Type.html#g-object-ref">
      <span class="code">g_object_ref()</span></a></span>). An instance can be ‘copied’ by
      calling <span class="code">g_object_ref()</span> again. Ownership can be freed with
      <span class="link"><a href="https://developer.gnome.org/gobject/stable/gobject-The-Base-Object-Type.html#g-object-unref" title="https://developer.gnome.org/gobject/stable/gobject-The-Base-Object-Type.html#g-object-unref">
      <span class="code">g_object_unref()</span></a></span> — even though this may not actually
      finalize the instance, it frees the current scope’s ownership of that
      instance.
    </p>
<p class="p">
      See <span class="link"><a href="memory-management.html.en.html#g-clear-object" title="#g-clear-object">#g-clear-object</a></span> for a convenient way of handling
      GObject references.
    </p>
<p class="p">
      There are other reference counted types in GLib, such as
      <span class="link"><a href="https://developer.gnome.org/glib/stable/glib-Hash-Tables.html" title="https://developer.gnome.org/glib/stable/glib-Hash-Tables.html">
      <span class="code">GHashTable</span></a></span> (using
      <span class="link"><a href="https://developer.gnome.org/glib/stable/glib-Hash-Tables.html#g-hash-table-ref" title="https://developer.gnome.org/glib/stable/glib-Hash-Tables.html#g-hash-table-ref">
      <span class="code">g_hash_table_ref()</span></a></span> and
      <span class="link"><a href="https://developer.gnome.org/glib/stable/glib-Hash-Tables.html#g-hash-table-unref" title="https://developer.gnome.org/glib/stable/glib-Hash-Tables.html#g-hash-table-unref">
      <span class="code">g_hash_table_unref()</span></a></span>), or
      <span class="link"><a href="https://developer.gnome.org/glib/stable/glib-GVariant.html" title="https://developer.gnome.org/glib/stable/glib-GVariant.html">
      <span class="code">GVariant</span></a></span>
      (<span class="link"><a href="https://developer.gnome.org/glib/stable/glib-GVariant.html#g-variant-ref" title="https://developer.gnome.org/glib/stable/glib-GVariant.html#g-variant-ref">
      <span class="code">g_variant_ref()</span></a></span>,
      <span class="link"><a href="https://developer.gnome.org/glib/stable/glib-GVariant.html#g-variant-unref" title="https://developer.gnome.org/glib/stable/glib-GVariant.html#g-variant-unref">
      <span class="code">g_variant_unref()</span></a></span>). Some types, like
      <span class="code">GHashTable</span>, support both reference counting and explicit
      finalization. Reference counting should always be used in preference,
      because it allows instances to be easily shared between multiple scopes
      (each holding their own reference) without having to allocate multiple
      copies of the instance. This saves memory.
    </p>
</div>
<div id="floating-references" class="sect"><div class="inner">
<div class="hgroup"><h3 class="title"><span class="title">Floating References</span></h3></div>
<div class="region"><div class="contents">
<p class="p">
        Classes which are derived from
        <span class="link"><a href="https://developer.gnome.org/gobject/stable/gobject-The-Base-Object-Type.html#GInitiallyUnowned" title="https://developer.gnome.org/gobject/stable/gobject-The-Base-Object-Type.html#GInitiallyUnowned"><span class="code">GInitiallyUnowned</span></a></span>,
        as opposed to
        <span class="link"><a href="https://developer.gnome.org/gobject/stable/gobject-The-Base-Object-Type.html#GObject-struct" title="https://developer.gnome.org/gobject/stable/gobject-The-Base-Object-Type.html#GObject-struct"><span class="code">GObject</span></a></span>
        have an initial reference which is <span class="em">floating</span>, meaning that no
        code owns the reference. As soon as
        <span class="link"><a href="https://developer.gnome.org/gobject/stable/gobject-The-Base-Object-Type.html#g-object-ref-sink" title="https://developer.gnome.org/gobject/stable/gobject-The-Base-Object-Type.html#g-object-ref-sink"><span class="code">g_object_ref_sink()</span></a></span>
        is called on the object, the floating reference is converted to a strong
        reference, and the calling code assumes ownership of the object.
      </p>
<p class="p">
        Floating references are a convenience for use in C in APIs, such as
        GTK+, where large numbers of objects must be created and organized into
        a hierarchy. In these cases, calling <span class="code">g_object_unref()</span> to
        drop all the strong references would result in a lot of code.
      </p>
<div class="example">
<p class="p">
          Floating references allow the following code to be simplified:
        </p>
<div class="code"><pre class="contents ">GtkWidget *new_widget;

new_widget = gtk_some_widget_new ();
gtk_container_add (some_container, new_widget);
g_object_unref (new_widget);</pre></div>
<p class="p">
          Instead, the following code can be used, with the
          <span class="code">GtkContainer</span> assuming ownership of the floating
          reference:
        </p>
<div class="code"><pre class="contents ">gtk_container_add (some_container, gtk_some_widget_new ());</pre></div>
</div>
<p class="p">
        Floating references are only used by a few APIs — in particular,
        <span class="code">GtkWidget</span> and all its subclasses. You must learn which APIs
        support it, and which APIs consume floating references, and only use
        them together.
      </p>
<p class="p">
        Note that <span class="code">g_object_ref_sink()</span> is equivalent to
        <span class="code">g_object_ref()</span> when called on a non-floating reference,
        making <span class="code">gtk_container_add()</span> no different from any other
        function in such cases.
      </p>
<p class="p">
        See the <span class="link"><a href="https://developer.gnome.org/gobject/stable/gobject-The-Base-Object-Type.html#floating-ref" title="https://developer.gnome.org/gobject/stable/gobject-The-Base-Object-Type.html#floating-ref">GObject
        manual</a></span> for more information on floating references.
      </p>
</div></div>
</div></div>
</div>
</div></div>
<div id="convenience-functions" class="sect"><div class="inner">
<div class="hgroup"><h2 class="title"><span class="title">Convenience Functions</span></h2></div>
<div class="region">
<div class="contents"><p class="p">
      GLib provides various convenience functions for memory management,
      especially for GObjects. Three will be covered here, but others exist —
      check the GLib API documentation for more. They typically follow similar
      naming schemas to these three (using ‘_full’ suffixes, or the verb ‘clear’
      in the function name).
    </p></div>
<div id="g-clear-object" class="sect"><div class="inner">
<div class="hgroup"><h3 class="title"><span class="title"><span class="code">g_clear_object()</span></span></h3></div>
<div class="region"><div class="contents">
<p class="p">
        <span class="link"><a href="https://developer.gnome.org/gobject/stable/gobject-The-Base-Object-Type.html#g-clear-object" title="https://developer.gnome.org/gobject/stable/gobject-The-Base-Object-Type.html#g-clear-object">
        <span class="code">g_clear_object()</span></a></span> is a version of
        <span class="link"><a href="https://developer.gnome.org/gobject/stable/gobject-The-Base-Object-Type.html#g-object-unref" title="https://developer.gnome.org/gobject/stable/gobject-The-Base-Object-Type.html#g-object-unref">
        <span class="code">g_object_unref()</span></a></span> which unrefs a GObject and then
        clears the pointer to it to <span class="code">NULL</span>.
      </p>
<p class="p">
        This makes it easier to implement code that guarantees a GObject pointer
        is always either <span class="code">NULL</span>, or has ownership of a GObject (but
        which never points to a GObject it no longer owns).
      </p>
<p class="p">
        By initialising all owned GObject pointers to <span class="code">NULL</span>, freeing
        them at the end of the scope is as simple as calling
        <span class="code">g_clear_object()</span> without any checks, as discussed in
        <span class="link"><a href="memory-management.html.en.html#single-path-cleanup" title="Single-Path Cleanup">Single-Path Cleanup</a></span>:
      </p>
<div class="code"><pre class="contents ">void
my_function (void)
{
  GObject *some_object = NULL;  /* owned */

  if (rand ())
    {
      some_object = create_new_object ();
      /* do something with the object */
    }

  g_clear_object (&amp;some_object);
}</pre></div>
</div></div>
</div></div>
<div id="g-list-free-full" class="sect"><div class="inner">
<div class="hgroup"><h3 class="title"><span class="title"><span class="code">g_list_free_full()</span></span></h3></div>
<div class="region"><div class="contents"><p class="p">
        <span class="link"><a href="https://developer.gnome.org/glib/stable/glib-Doubly-Linked-Lists.html#g-list-free-full" title="https://developer.gnome.org/glib/stable/glib-Doubly-Linked-Lists.html#g-list-free-full">
        <span class="code">g_list_free_full()</span></a></span> frees all the elements in a
        linked list, <span class="em">and all their data</span>. It is much more convenient
        than iterating through the list to free all the elements’ data, then
        calling <span class="link"><a href="https://developer.gnome.org/glib/stable/glib-Doubly-Linked-Lists.html#g-list-free" title="https://developer.gnome.org/glib/stable/glib-Doubly-Linked-Lists.html#g-list-free">
        <span class="code">g_list_free()</span></a></span> to free the <span class="code">GList</span>
        elements themselves.
      </p></div></div>
</div></div>
<div id="g-hash-table-new-full" class="sect"><div class="inner">
<div class="hgroup"><h3 class="title"><span class="title"><span class="code">g_hash_table_new_full()</span></span></h3></div>
<div class="region"><div class="contents">
<p class="p">
        <span class="link"><a href="https://developer.gnome.org/glib/stable/glib-Hash-Tables.html#g-hash-table-new-full" title="https://developer.gnome.org/glib/stable/glib-Hash-Tables.html#g-hash-table-new-full">
        <span class="code">g_hash_table_new_full()</span></a></span> is a newer version of
        <span class="link"><a href="https://developer.gnome.org/glib/stable/glib-Hash-Tables.html#g-hash-table-new" title="https://developer.gnome.org/glib/stable/glib-Hash-Tables.html#g-hash-table-new">
        <span class="code">g_hash_table_new()</span></a></span> which allows setting functions to
        destroy each key and value in the hash table when they are removed.
        These functions are then automatically called for all keys and values
        when the hash table is destroyed, or when an entry is removed using
        <span class="code">g_hash_table_remove()</span>.
      </p>
<p class="p">
        Essentially, it simplifies memory management of keys and values to the
        question of whether they are present in the hash table. See
        <span class="link"><a href="memory-management.html.en.html#container-types" title="Container Types">Container Types</a></span> for a discussion on ownership of
        elements within container types.
      </p>
<p class="p">
        A similar function exists for <span class="code">GPtrArray</span>:
        <span class="link"><a href="https://developer.gnome.org/glib/stable/glib-Pointer-Arrays.html#g-ptr-array-new-with-free-func" title="https://developer.gnome.org/glib/stable/glib-Pointer-Arrays.html#g-ptr-array-new-with-free-func">
        <span class="code">g_ptr_array_new_with_free_func()</span></a></span>.
      </p>
</div></div>
</div></div>
</div>
</div></div>
<div id="container-types" class="sect"><div class="inner">
<div class="hgroup"><h2 class="title"><span class="title">Container Types</span></h2></div>
<div class="region"><div class="contents">
<p class="p">
      When using container types, such as <span class="code">GPtrArray</span> or
      <span class="code">GList</span>, an additional level of ownership is introduced: as
      well as the ownership of the container instance, each element in the
      container is either owned or unowned too. By nesting containers, multiple
      levels of ownership must be tracked. Ownership of owned elements belongs
      to the container; ownership of the container belongs to the scope it’s in
      (which may be another container).
    </p>
<p class="p">
      A key principle for simplifying this is to ensure that all elements in a
      container have the same ownership: they are either all owned, or all
      unowned. This happens automatically if the normal
      <span class="link"><a href="memory-management.html.en.html#convenience-functions" title="Convenience Functions">Convenience Functions</a></span> are used for types like
      <span class="code">GPtrArray</span> and <span class="code">GHashTable</span>.
    </p>
<p class="p">
      If elements in a container are <span class="em">owned</span>, adding them to the
      container is essentially an ownership transfer. For example, for an array
      of strings, if the elements are owned, the definition of
      <span class="code">g_ptr_array_add()</span> is effectively:
    </p>
<div class="code"><pre class="contents ">/**
 * g_ptr_array_add:
 * @array: a #GPtrArray
 * @str: (transfer full): string to add
 */
void
g_ptr_array_add (GPtrArray *array,
                 gchar     *str);</pre></div>
<p class="p">
      So, for example, constant (unowned) strings must be added to the array
      using <span class="code">g_ptr_array_add (array, g_strdup ("constant string"))</span>.
    </p>
<p class="p">
      Whereas if the elements are unowned, the definition is effectively:
    </p>
<div class="code"><pre class="contents ">/**
 * g_ptr_array_add:
 * @array: a #GPtrArray
 * @str: (transfer none): string to add
 */
void
g_ptr_array_add (GPtrArray   *array,
                 const gchar *str);</pre></div>
<p class="p">
      Here, constant strings can be added without copying them:
      <span class="code">g_ptr_array_add (array, "constant string")</span>.
    </p>
<p class="p">
      See <span class="link"><a href="memory-management.html.en.html#documentation" title="Documentation">Documentation</a></span> for examples of comments to add to
      variable definitions to annotate them with the element type and ownership.
    </p>
</div></div>
</div></div>
<div id="single-path-cleanup" class="sect"><div class="inner">
<div class="hgroup"><h2 class="title"><span class="title">Single-Path Cleanup</span></h2></div>
<div class="region"><div class="contents">
<p class="p">
      A useful design pattern for more complex functions is to have a single
      control path which cleans up (frees) allocations and returns to the
      caller. This vastly simplifies tracking of allocations, as it’s no longer
      necessary to mentally work out which allocations have been freed on each
      code path — all code paths end at the same point, so perform all the frees
      then. The benefits of this approach rapidly become greater for larger
      functions with more owned local variables; it may not make sense to apply
      the pattern to smaller functions.
    </p>
<p class="p">
      This approach has two requirements:
    </p>
<div class="list"><div class="inner"><div class="region"><ol class="list" style="list-style-type:numbered">
<li class="list"><p class="p">
        The function returns from a single point, and uses <span class="code">goto</span> to
        reach that point from other paths.
      </p></li>
<li class="list"><p class="p">
        All owned variables are set to <span class="code">NULL</span> when initialized or
        when ownership is transferred away from them.
      </p></li>
</ol></div></div></div>
<p class="p">
      The example below is for a small function (for brevity), but should
      illustrate the principles for application of the pattern to larger
      functions:
    </p>
<div class="listing"><div class="inner">
<div class="title title-listing"><h3><span class="title">Single-Path Cleanup Example</span></h3></div>
<div class="region">
<div class="desc">
        Example of implementing single-path cleanup for a simple function
      </div>
<div class="contents"><div class="code"><pre class="contents ">GObject *
some_function (GError **error)
{
  gchar *some_str = NULL;  /* owned */
  GObject *temp_object = NULL;  /* owned */
  const gchar *temp_str;
  GObject *my_object = NULL;  /* owned */
  GError *child_error = NULL;  /* owned */

  temp_object = generate_object ();
  temp_str = "example string";

  if (rand ())
    {
      some_str = g_strconcat (temp_str, temp_str, NULL);
    }
  else
    {
      some_operation_which_might_fail (&amp;child_error);

      if (child_error != NULL)
        {
          goto done;
        }

      my_object = generate_wrapped_object (temp_object);
    }

done:
  /* Here, @some_str is either NULL or a string to be freed, so can be passed to
   * g_free() unconditionally.
   *
   * Similarly, @temp_object is either NULL or an object to be unreffed, so can
   * be passed to g_clear_object() unconditionally. */
  g_free (some_str);
  g_clear_object (&amp;temp_object);

  /* The pattern can also be used to ensure that the function always returns
   * either an error or a return value (but never both). */
  if (child_error != NULL)
    {
      g_propagate_error (error, child_error);
      g_clear_object (&amp;my_object);
    }

  return my_object;
}</pre></div></div>
</div>
</div></div>
</div></div>
</div></div>
<div id="verification" class="sect"><div class="inner">
<div class="hgroup"><h2 class="title"><span class="title">Verification</span></h2></div>
<div class="region"><div class="contents">
<p class="p">
      Memory leaks can be checked for in two ways: static analysis, and runtime
      leak checking.
    </p>
<p class="p">
      Static analysis with tools like
      <span class="link"><a href="tooling.html.en.html#coverity" title="Coverity">Coverity</a></span>, the
      <span class="link"><a href="tooling.html.en.html#clang-static-analyzer" title="Clang Static Analyzer">Clang static analyzer</a></span> or
      <span class="link"><a href="tooling.html.en.html#tartan" title="tooling#tartan">Tartan</a></span> can
      catch some leaks, but require knowledge of the ownership transfer of every
      function called in the code. Domain-specific static analyzers like Tartan
      (which knows about GLib memory allocation and transfer) can perform better
      here, but Tartan is quite a young project and still misses things (a low
      true positive rate). It is recommended that code be put through a static
      analyzer, but the primary tool for detecting leaks should be runtime leak
      checking.
    </p>
<p class="p">
      Runtime leak checking is done using
      <span class="link"><a href="tooling.html.en.html#valgrind" title="Valgrind">Valgrind</a></span>, using its
      <span class="link"><a href="tooling.html.en.html#memcheck" title="tooling#memcheck">memcheck</a></span> tool. Any leak it detects as
      ‘definitely losing memory’ should be fixed. Many of the leaks which
      ‘potentially’ lose memory are not real leaks, and should be added to the
      suppression file.
    </p>
<p class="p">
      If compiling with a recent version of Clang or GCC, the
      <span class="link"><a href="tooling.html.en.html#address-sanitizer" title="tooling#address-sanitizer">address sanitizer</a></span> can be
      enabled instead, and it will detect memory leaks and overflow problems at
      runtime, but without the difficulty of running Valgrind in the right
      environment. Note, however, that it is still a young tool, so may fail in
      some cases.
    </p>
<p class="p">
      See <span class="link"><a href="tooling.html.en.html#valgrind" title="Valgrind">Valgrind</a></span> for more information on using
      Valgrind.
    </p>
</div></div>
</div></div>
<div class="sect sect-links" role="navigation">
<div class="hgroup"></div>
<div class="contents"><div class="links guidelinks"><div class="inner">
<div class="title"><h2><span class="title">More Information</span></h2></div>
<div class="region"><ul><li class="links "><a href="index.html.en.html#general-guidelines" title="General Guidelines">General Guidelines</a></li></ul></div>
</div></div></div>
</div>
</div>
<div class="clear"></div>
</div></div>
<div class="content about"><div>
<div class="sect about ui-expander" role="contentinfo">
<div class="yelp-data yelp-data-ui-expander" data-yelp-expanded="false"></div>
<div class="inner">
<div class="hgroup"><h2><span class="title">About</span></h2></div>
<div class="region"><div class="contents">
<div class="copyrights"><div class="copyright">© 2015 Philip Withnall</div></div>
<div class="aboutblurb authors">
<div class="title"><span class="title">Written By</span></div>
<ul class="credits"><li>Philip Withnall</li></ul>
</div>
<div class="aboutblurb license">
<div class="title"><span class="title">Creative Commons</span></div>
<div class="contents">
<p class="p">This work is licensed under a
<span class="link"><a href="http://creativecommons.org/licenses/by-sa/3.0/us/" title="http://creativecommons.org/licenses/by-sa/3.0/us/">Creative Commons
Attribution-Share Alike 3.0 United States License</a></span>.</p>
<p class="p">As a special exception, the copyright holders give you permission to copy,
modify, and distribute the example code contained in this document under the
terms of your choosing, without restriction.</p>
</div>
</div>
</div></div>
</div>
</div>
<p class="action_box doc-feedback">Got a comment? Spotted an error? Found the instructions unclear? <a class="button" href="mailto:docs-feedback@gnome.org?subject=Feedback%20on%20programming-guidelines/3.38/memory-management.page">Send feedback about this page.</a></p>
</div></div>
<div id="footer_art" class="default"> </div>
</div>
<div class="clearfix"></div>
<div id="footer_grass">   </div>
<div id="footer"><div class="container_12">
<div class="links grid_9">
<div class="menu-footer-1-container"><ul id="menu-footer-1" class="menu"><li id="menu-item-88" class="menu-item menu-item-type-custom menu-item-home menu-item-88">
<a href="https://www.gnome.org/">The GNOME Project</a><ul class="sub-menu">
<li id="menu-item-89" class="menu-item menu-item-type-post_type menu-item-89"><a href="https://www.gnome.org/about/">About Us</a></li>
<li id="menu-item-90" class="menu-item menu-item-type-custom menu-item-90"><a href="https://www.gnome.org/get-involved/">Get Involved</a></li>
<li id="menu-item-91" class="menu-item menu-item-type-custom menu-item-91"><a href="https://www.gnome.org/teams/">Teams</a></li>
<li id="menu-item-92" class="menu-item menu-item-type-custom menu-item-92"><a href="https://foundation.gnome.org">The GNOME Foundation</a></li>
<li><a href="https://www.gnome.org/support-gnome/">Support GNOME</a></li>
<li><a href="https://www.gnome.org/contact/">Contact</a></li>
</ul>
</li></ul></div>
<div class="menu-footer-2-container"><ul id="menu-footer-2" class="menu"><li id="menu-item-99" class="menu-item menu-item-type-post_type current-menu-item page_item page-item-20 current_page_item menu-item-99">
<a href="memory-management.html.en.html#">Resources</a><ul class="sub-menu">
<li><a href="https://help.gnome.org">Documentation</a></li>
<li><a href="https://wiki.gnome.org">Wiki</a></li>
<li><a href="https://mail.gnome.org/mailman/listinfo">Mailing Lists</a></li>
<li><a href="https://wiki.gnome.org/GnomeIrcChannels">IRC Channels</a></li>
<li><a href="https://gitlab.gnome.org/">Bug Tracker</a></li>
<li><a href="https://gitlab.gnome.org/">Development Code</a></li>
<li><a href="https://wiki.gnome.org/Jhbuild">Build Tool</a></li>
</ul>
</li></ul></div>
<div class="menu-footer-4-container"><ul id="menu-footer-4" class="menu"><li id="menu-item-104" class="menu-item menu-item-type-custom menu-item-104">
<a href="http://www.gnome.org/news/">News</a><ul class="sub-menu">
<li><a href="https://www.gnome.org/start/stable">Latest Release</a></li>
<li><a href="https://planet.gnome.org">Planet GNOME</a></li>
<li><a href="https://news.gnome.org">Development News</a></li>
<li><a href="https://twitter.com/gnome">Twitter</a></li>
</ul>
</li></ul></div>
</div>
<div class="links grid_3 right"><div>
<ul class="menu available_languages"><li>
<strong>This website is available in many languages</strong><ul class="sub-menu"><li><a href="../../languages.html" title="Switching Language">Switch Language</a></li></ul>
</li></ul>
<script type="text/javascript" src="../../js/language.js"></script>
</div></div>
<div id="footnotes" class="grid_9">
                Copyright © 2005‒2014 <strong class="gnome_logo">The GNOME Project</strong><br><small>Optimised for standards. Hosted by <a href="http://redhat.com">Red Hat</a>.</small>
</div>
<div class="clear"></div>
</div></div>
<script type="text/javascript">
$(document).ready(function() {
    // Get browser
    $.each($.browser, function(i) {
        $('body').addClass(i);
        return false;
    });

    // Get OS and add it as class to body tag, this then allows forcing some
    // customisation in the CSS rules.
    var match = navigator.userAgent.toLowerCase().match(/(win|mac|linux)/);
    if (match) {
        $('body').addClass(match[0]);
    }
});
</script><script type="text/javascript">
      var _paq = _paq || [];
      _paq.push(['disableCookies']);
      _paq.push(["trackPageView"]);
      _paq.push(["enableLinkTracking"]);

      (function() {
        var u=(("https:" == document.location.protocol) ? "https" : "http") + "://webstats.gnome.org/";
        _paq.push(["setTrackerUrl", u+"piwik.php"]);
        _paq.push(["setSiteId", "6"]);
        var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";
        g.defer=true; g.async=true; g.src=u+"piwik.js"; s.parentNode.insertBefore(g,s);
      })();
    </script>
</body>
</html>
